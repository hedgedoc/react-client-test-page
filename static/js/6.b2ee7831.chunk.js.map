{"version":3,"sources":["components/markdown-renderer/document-length-limit-reached-alert.tsx","components/markdown-renderer/utils/html-react-transformer.tsx","components/markdown-renderer/hooks/use-convert-markdown-to-react-dom.ts","components/markdown-renderer/utils/line-number-mapping.ts","components/markdown-renderer/replace-components/abc/abc-frame.tsx","components/markdown-renderer/replace-components/abc/abc-replacer.tsx","components/markdown-renderer/replace-components/utils.ts","components/markdown-renderer/replace-components/one-click-frame/one-click-embedding.tsx","components/markdown-renderer/replace-components/asciinema/asciinema-frame.tsx","components/markdown-renderer/replace-components/asciinema/replace-asciinema-link.ts","components/markdown-renderer/replace-components/asciinema/asciinema-replacer.tsx","components/markdown-renderer/replace-components/csv/csv-parser.ts","components/markdown-renderer/replace-components/csv/csv-table.tsx","components/markdown-renderer/replace-components/csv/csv-replacer.tsx","components/markdown-renderer/replace-components/flow/flowchart/flowchart.tsx","components/markdown-renderer/replace-components/flow/flowchart-replacer.tsx","components/markdown-renderer/replace-components/gist/gist-frame.tsx","components/markdown-renderer/replace-components/gist/gist-preview.png","components/markdown-renderer/replace-components/gist/replace-gist-link.ts","components/markdown-renderer/replace-components/gist/replace-legacy-gist-short-code.ts","components/markdown-renderer/replace-components/gist/gist-replacer.tsx","components/markdown-renderer/replace-components/graphviz/graphviz-frame.tsx","components/markdown-renderer/replace-components/graphviz/graphviz-replacer.tsx","components/markdown-renderer/replace-components/highlighted-fence/highlighted-fence-replacer.tsx","components/markdown-renderer/replace-components/image/image-replacer.tsx","components/markdown-renderer/replace-components/katex/katex-replacer.tsx","components/markdown-renderer/replace-components/linemarker/linemarker-replacer.tsx","components/common/lock-button/lock-button.tsx","components/markdown-renderer/replace-components/markmap/markmap-frame.tsx","components/markdown-renderer/replace-components/markmap/markmap-replacer.tsx","components/markdown-renderer/replace-components/mermaid/mermaid-chart.tsx","components/markdown-renderer/replace-components/mermaid/mermaid-replacer.tsx","components/markdown-renderer/replace-components/colored-blockquote/colored-blockquote-replacer.tsx","components/markdown-renderer/replace-components/sequence-diagram/deprecation-warning.tsx","components/markdown-renderer/replace-components/sequence-diagram/sequence-diagram-replacer.tsx","components/markdown-renderer/replace-components/task-list/task-list-replacer.tsx","components/markdown-renderer/replace-components/vega-lite/vega-chart.tsx","components/markdown-renderer/replace-components/vega-lite/vega-replacer.tsx","components/markdown-renderer/replace-components/vimeo/replace-legacy-vimeo-short-code.ts","components/markdown-renderer/replace-components/vimeo/replace-vimeo-link.ts","components/markdown-renderer/replace-components/vimeo/vimeo-frame.tsx","components/markdown-renderer/replace-components/vimeo/vimeo-replacer.tsx","components/markdown-renderer/replace-components/youtube/replace-legacy-youtube-short-code.ts","components/markdown-renderer/replace-components/youtube/replace-youtube-link.ts","components/markdown-renderer/replace-components/youtube/youtube-frame.tsx","components/markdown-renderer/replace-components/youtube/youtube-replacer.tsx","components/markdown-renderer/hooks/use-component-replacers.ts","components/markdown-renderer/utils/calculate-line-marker-positions.ts","components/markdown-renderer/hooks/use-on-ref-change.ts","components/markdown-renderer/markdown-it-plugins/linkify-extra.ts","components/markdown-renderer/markdown-it-plugins/parser-debugger.ts","components/markdown-renderer/markdown-it-plugins/spoiler-container.ts","components/markdown-renderer/markdown-it-plugins/tasks-lists.ts","components/markdown-renderer/markdown-it-plugins/emoji/mapping.ts","components/markdown-renderer/markdown-it-plugins/twitter-emojis.ts","components/markdown-renderer/markdown-it-plugins/plantuml.ts","components/markdown-renderer/markdown-it-plugins/headline-anchors.ts","components/markdown-renderer/regex-plugins/replace-legacy-pdf-short-code.ts","components/markdown-renderer/regex-plugins/replace-legacy-slideshare-short-code.ts","components/markdown-renderer/regex-plugins/replace-legacy-speakerdeck-short-code.ts","components/markdown-renderer/markdown-it-plugins/highlighted-code.ts","components/markdown-renderer/markdown-it-plugins/quote-extra.ts","components/markdown-renderer/markdown-it-plugins/quote-extra-color.ts","components/markdown-renderer/markdown-it-plugins/document-table-of-contents.ts","components/markdown-renderer/markdown-it-plugins/document-toc.ts","components/markdown-renderer/markdown-it-configurator/BasicMarkdownItConfigurator.tsx","components/markdown-renderer/markdown-it-plugins/frontmatter.ts","components/markdown-renderer/replace-components/linemarker/line-number-marker.ts","components/markdown-renderer/invalid-yaml-alert.tsx","components/markdown-renderer/basic-markdown-renderer.tsx","components/markdown-renderer/hooks/use-trimmed-content.ts","components/markdown-renderer/hooks/use-extract-first-headline.ts","components/markdown-renderer/replace-components/ComponentReplacer.ts","components/markdown-renderer/replace-components/link-replacer/link-replacer.tsx","../node_modules/markdown-it-imsize/lib/imsize/types sync /^/.//.*$","components/editor-page/table-of-contents/toc-slugify.ts","components/common/copyable/copy-to-clipboard-button/copy-to-clipboard-button.tsx","components/markdown-renderer/replace-components/highlighted-fence/highlighted-code/highlighted-code.tsx"],"names":["DocumentLengthLimitReachedAlert","show","useTranslation","maxLength","useApplicationState","state","config","maxDocumentLength","condition","Alert","variant","dir","data-cy","Trans","i18nKey","values","buildTransformer","lineKeys","allReplacers","transform","node","index","isTag","convertNodeToReactElement","nativeRenderer","key","undefined","attribs","renderNativeNode","lineMarker","prev","startLineInMarkdown","endLineInMarkdown","startLineIndex","Number","endLineIndex","startLine","endLine","id","calculateKeyFromLineMarker","toString","tryReplacement","subNodeTransform","replacement","getReplacement","findNodeReplacement","subNode","subKey","fallback","useConvertMarkdownToReactDom","markdownCode","markdownIt","replacers","onBeforeRendering","onAfterRendering","oldMarkdownLineKeys","useRef","lastUsedLineId","useMemo","html","render","newMarkdownLines","oldLineKeys","lineDifferences","diffArrays","comparator","left","right","line","newLines","filter","change","added","forEach","value","removed","push","lines","calculateNewLineNumberMapping","split","current","newLastUsedLineId","currentReplacers","transformer","length","rendering","convertHtmlToReact","AbcFrame","code","container","useEffect","actualContainer","then","imp","renderAbc","catch","console","error","ref","className","AbcReplacer","codeNode","name","children","ComponentReplacer","extractTextChildContent","getAttributesFromHedgeDocTag","tagName","OneClickEmbedding","previewContainerClassName","containerClassName","onImageFetch","loadingImageUrl","tooltip","hoverIcon","hoverTextI18nKey","onActivate","useState","showFrame","setShowFrame","previewImageUrl","setPreviewImageUrl","imageLink","message","onClick","src","alt","title","AsciinemaFrame","gistUrlRegex","RegExp","source","replaceAsciinemaLink","regex","replace","match","AsciinemaReplacer","attributes","asciinemaId","markdownItPlugin","markdownItRegex","CsvTable","rows","delimiter","showHeader","tableRowClassName","tableColumnClassName","rowsWithColumns","csvText","csvColumnDelimiter","splitRegex","row","map","parseCsv","trim","headerRow","splice","column","columnNumber","renderTableHeader","rowNumber","columnIndex","CsvReplacer","extraData","extraInfos","exec","FlowChart","diagramRef","setError","darkModeActivated","useIsDarkModeActivated","currentDiagramRef","parserOutput","parse","drawSVG","fill","Array","from","remove","FlowchartReplacer","GistFrame","iframeHtml","frameHeight","setFrameHeight","sizeMessage","useCallback","data","size","window","addEventListener","removeEventListener","sandbox","width","height","frameBorder","btoa","replaceGistLink","replaceLegacyGistShortCode","GistReplacer","gistId","preview","GraphvizFrame","showError","querySelectorAll","child","frontendBaseUrl","useFrontendBaseUrl","wasmPlugin","wasmFolder","graphvizImport","graphviz","useWorker","zoom","onerror","renderDot","GraphvizReplacer","HighlightedCodeReplacer","lastLineNumber","language","showLineNumbers","startLineNumberAttribute","wrapLines","startsWith","startLineNumber","this","parseInt","ImageReplacer","clickHandler","class","KaTeX","React","lazy","KatexReplacer","katex","find","subnode","inline","getNodeIfKatexBlock","getNodeIfInlineKatex","mathJaxContent","isInline","block","math","errorColor","mathJax","beforeMath","afterMath","beforeInlineMath","afterInlineMath","beforeDisplayMath","afterDisplayMath","LinemarkerReplacer","LockButton","locked","onLockedChanged","Button","icon","blockHandler","event","stopPropagation","MarkmapFrame","t","diagramContainer","disablePanAndZoom","setDisablePanAndZoom","markmapLoader","svg","document","createElementNS","setAttribute","appendChild","newState","MarkmapReplacer","mermaidInitialized","MermaidChart","mermaid","default","initialize","startOnLoad","dataset","processed","textContent","init","str","MermaidReplacer","isBlockquoteColorDefinition","ColoredBlockquoteReplacer","paragraph","childElements","optionsTag","elem","Object","assign","style","DeprecationWarning","href","links","faq","SequenceDiagramReplacer","TaskListReplacer","onTaskCheckedChange","handleCheckboxChange","lineNum","currentTarget","checked","disabled","type","onChange","data-line","VegaChart","embed","spec","JSON","actions","export","compiled","editor","i18n","PNG_ACTION","SVG_ACTION","VegaReplacer","replaceLegacyVimeoShortCode","vimeoVideoUrlRegex","replaceVimeoLink","VimeoFrame","getPreviewImageLink","a","fetch","credentials","referrerPolicy","response","status","Error","json","vimeoResponse","thumbnail_large","allow","VimeoReplacer","videoId","replaceLegacyYoutubeShortCode","youtubeVideoUrlRegex","replaceYouTubeLink","YouTubeFrame","YoutubeReplacer","useCalculateLineMarkerPosition","documentElement","lineMarkers","onLineMarkerPositionChanged","offset","lastLineMarkerPositions","calculateNewLineMarkerPositions","currentLineMarkers","lineMarkerPositions","childIndex","htmlChild","offsetTop","currentLineMarker","lastPosition","position","offsetHeight","calculateLineMarkerPositions","equal","useResizeObserver","onResize","useOnRefChange","reference","lastValue","linkifyExtra","md","core","ruler","options","linkify","MarkdownItParserDebugger","process","spoilerRegEx","spoilerContainer","markdownItContainer","validate","params","test","tokens","matches","info","nesting","escapeHtml","tasksLists","markdownItTaskLists","enabled","label","lineNumber","shortCodeMap","emojiData","reduce","reduceObject","emoji","shortcodes","shortcode","emojiSkinToneModifierMap","modifierValue","codepoint","forkAwesomeIconMap","keys","ForkAwesomeIcons","combinedEmojiData","twitterEmojis","defs","plantumlWithError","plantumlServer","store","getState","plantuml","openMarker","closeMarker","server","plantumlError","defaultRenderer","renderer","rules","fence","idx","env","slf","headlineAnchors","anchor","permalink","permalinkBefore","permalinkClass","permalinkSymbol","permalinkHref","slug","finalRegex","legacyPdfShortCode","legacySlideshareShortCode","legacySpeakerdeckShortCode","highlightRegex","highlightedCode","token","highlightInfos","attrJoin","quoteExtra","quoteLabel","quoteExtraTagValues","parseQuoteExtraTag","pos","posMax","valueEndIndex","attrSet","innerTokens","innerHtml","renderInline","attrGet","start","maxPos","labelStartIndex","labelEndIndex","parseLabel","valueStartIndex","parseValue","substr","level","currentCharacter","cssColorRegex","quoteExtraColor","color","documentTableOfContents","onTocChange","onToc","toc","placeholder","listType","callback","ast","slugify","tocSlugify","documentToc","BasicMarkdownItConfigurator","configurations","postConfigurations","plugin","MarkdownIt","breaks","useAlternativeBreaks","langPrefix","typographer","configure","configuration","use","postConfiguration","abbreviation","definitionList","subscript","superscript","inserted","marked","footnote","imsize","alertContainer","useFrontmatter","onParseError","onRawMetaChange","frontmatter","rawMeta","meta","yaml","load","e","onLineMarkers","tagTokens","app_linemarker","endLineNumber","insertNewLineMarker","tokenPosition","startToken","Token","attrPush","hidden","lineNumberMarker","InvalidYamlAlert","text","BasicMarkdownRenderer","content","additionalReplacers","onFirstHeadingChange","onFrontmatterChange","baseUrl","onImageClick","outerContainerRef","rawMetaRef","markdownBodyRef","hasNewYamlError","tocAst","showYamlError","setShowYamlError","contentExceedsLimit","useTrimmedContent","trimmedContent","errorState","buildConfiguredMarkdownIt","clearFrontmatter","checkYamlErrorState","baseReplacers","LinkReplacer","useComponentReplacers","concat","markdownReactDom","extractInnerText","classList","contains","innerText","childNodes","nodeName","getAttribute","lastFirstHeading","firstHeading","getElementsByTagName","item","headingText","useExtractFirstHeadline","newValue","NoteFrontmatter","childrenTextNode","isText","createJumpToMarkClickEventHandler","getElementById","scrollIntoView","preventDefault","url","isJumpMark","URL","rel","target","webpackContext","req","webpackContextResolve","__webpack_require__","o","resolve","module","exports","encodeURIComponent","toLowerCase","CopyToClipboardButton","props","button","clickComponent","HighlightedCode","dom","setDom","hljs","lang","replacedDom","replaceCode","listLanguages","includes","highlight","replaceAll"],"mappings":"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","file":"static/js/6.b2ee7831.chunk.js","sourcesContent":["/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React from 'react'\nimport { Alert } from 'react-bootstrap'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { useApplicationState } from '../../hooks/common/use-application-state'\nimport { ShowIf } from '../common/show-if/show-if'\nimport { SimpleAlertProps } from '../common/simple-alert/simple-alert-props'\n\nexport const DocumentLengthLimitReachedAlert: React.FC<SimpleAlertProps> = ({ show }) => {\n  useTranslation()\n\n  const maxLength = useApplicationState((state) => state.config.maxDocumentLength)\n\n  return (\n    <ShowIf condition={show}>\n      <Alert variant='danger' dir={'auto'} data-cy={'limitReachedMessage'}>\n        <Trans i18nKey={'editor.error.limitReached.description'} values={{ maxLength }} />\n      </Alert>\n    </ShowIf>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element, isTag } from 'domhandler'\nimport React, { Suspense } from 'react'\nimport { convertNodeToReactElement } from '@hedgedoc/html-to-react/dist/convertNodeToReactElement'\nimport {\n  ComponentReplacer,\n  NativeRenderer,\n  SubNodeTransform,\n  ValidReactDomElement\n} from '../replace-components/ComponentReplacer'\nimport { LineKeys } from '../types'\nimport { NodeToReactElementTransformer } from '@hedgedoc/html-to-react/dist/NodeToReactElementTransformer'\n\nexport interface TextDifferenceResult {\n  lines: LineKeys[]\n  lastUsedLineId: number\n}\n\nexport const calculateKeyFromLineMarker = (node: Element, lineKeys?: LineKeys[]): string | undefined => {\n  if (!node.attribs || lineKeys === undefined) {\n    return\n  }\n\n  const key = node.attribs['data-key']\n  if (key) {\n    return key\n  }\n\n  const lineMarker = node.prev\n  if (!lineMarker || !isTag(lineMarker) || !lineMarker.attribs) {\n    return\n  }\n\n  const startLineInMarkdown = lineMarker.attribs['data-start-line']\n  const endLineInMarkdown = lineMarker.attribs['data-end-line']\n  if (startLineInMarkdown === undefined || endLineInMarkdown === undefined) {\n    return\n  }\n\n  const startLineIndex = Number(startLineInMarkdown)\n  const endLineIndex = Number(endLineInMarkdown)\n  const startLine = lineKeys[startLineIndex - 1]\n  const endLine = lineKeys[endLineIndex - 2]\n  if (startLine === undefined || endLine === undefined) {\n    return\n  }\n\n  return `${startLine.id}_${endLine.id}`\n}\n\nexport const findNodeReplacement = (\n  node: Element,\n  allReplacers: ComponentReplacer[],\n  subNodeTransform: SubNodeTransform,\n  nativeRenderer: NativeRenderer\n): ValidReactDomElement | undefined => {\n  for (const componentReplacer of allReplacers) {\n    const replacement = componentReplacer.getReplacement(node, subNodeTransform, nativeRenderer)\n    if (replacement !== undefined) {\n      return replacement\n    }\n  }\n}\n\n/**\n * Renders the given node without any replacement\n *\n * @param node The node to render\n * @param key The unique key for the node\n * @param transform The transform function that should be applied to the child nodes\n */\nexport const renderNativeNode = (\n  node: Element,\n  key: string,\n  transform: NodeToReactElementTransformer\n): ValidReactDomElement => {\n  if (node.attribs === undefined) {\n    node.attribs = {}\n  }\n\n  delete node.attribs['data-key']\n  return convertNodeToReactElement(node, key, transform)\n}\n\nexport const buildTransformer = (\n  lineKeys: LineKeys[] | undefined,\n  allReplacers: ComponentReplacer[]\n): NodeToReactElementTransformer => {\n  const transform: NodeToReactElementTransformer = (node, index) => {\n    if (!isTag(node)) {\n      return convertNodeToReactElement(node, index)\n    }\n    const nativeRenderer: NativeRenderer = () => renderNativeNode(node, key, transform)\n    const subNodeTransform: SubNodeTransform = (subNode, subKey) => transform(subNode, subKey, transform)\n\n    const key = calculateKeyFromLineMarker(node, lineKeys) ?? (-index).toString()\n    const tryReplacement = findNodeReplacement(node, allReplacers, subNodeTransform, nativeRenderer)\n    if (tryReplacement === null) {\n      return null\n    } else if (tryReplacement === undefined) {\n      return nativeRenderer()\n    } else {\n      return (\n        <Suspense key={key} fallback={<span>Loading...</span>}>\n          {tryReplacement}\n        </Suspense>\n      )\n    }\n  }\n  return transform\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\nimport { useMemo, useRef } from 'react'\nimport { ComponentReplacer, ValidReactDomElement } from '../replace-components/ComponentReplacer'\nimport { LineKeys } from '../types'\nimport { buildTransformer } from '../utils/html-react-transformer'\nimport { calculateNewLineNumberMapping } from '../utils/line-number-mapping'\nimport convertHtmlToReact from '@hedgedoc/html-to-react'\n\n/**\n * Renders markdown code into react elements\n *\n * @param markdownCode The markdown code that should be rendered\n * @param markdownIt The configured {@link MarkdownIt markdown it} instance that should render the code\n * @param replacers A function that provides a list of {@link ComponentReplacer component replacers}\n * @param onBeforeRendering A callback that gets executed before the rendering\n * @param onAfterRendering A callback that gets executed after the rendering\n * @return The React DOM that represents the rendered markdown code\n */\nexport const useConvertMarkdownToReactDom = (\n  markdownCode: string,\n  markdownIt: MarkdownIt,\n  replacers: () => ComponentReplacer[],\n  onBeforeRendering?: () => void,\n  onAfterRendering?: () => void\n): ValidReactDomElement[] => {\n  const oldMarkdownLineKeys = useRef<LineKeys[]>()\n  const lastUsedLineId = useRef<number>(0)\n\n  return useMemo(() => {\n    if (onBeforeRendering) {\n      onBeforeRendering()\n    }\n    const html = markdownIt.render(markdownCode)\n    const contentLines = markdownCode.split('\\n')\n    const { lines: newLines, lastUsedLineId: newLastUsedLineId } = calculateNewLineNumberMapping(\n      contentLines,\n      oldMarkdownLineKeys.current ?? [],\n      lastUsedLineId.current\n    )\n    oldMarkdownLineKeys.current = newLines\n    lastUsedLineId.current = newLastUsedLineId\n\n    const currentReplacers = replacers()\n    const transformer = currentReplacers.length > 0 ? buildTransformer(newLines, currentReplacers) : undefined\n    const rendering = convertHtmlToReact(html, { transform: transformer })\n    if (onAfterRendering) {\n      onAfterRendering()\n    }\n    return rendering\n  }, [onBeforeRendering, markdownIt, markdownCode, replacers, onAfterRendering])\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { diffArrays } from 'diff'\nimport { TextDifferenceResult } from './html-react-transformer'\nimport { LineKeys } from '../types'\n\nexport const calculateNewLineNumberMapping = (\n  newMarkdownLines: string[],\n  oldLineKeys: LineKeys[],\n  lastUsedLineId: number\n): TextDifferenceResult => {\n  const lineDifferences = diffArrays<string, LineKeys>(newMarkdownLines, oldLineKeys, {\n    comparator: (left: string | LineKeys, right: string | LineKeys) => {\n      const leftLine = (left as LineKeys).line ?? (left as string)\n      const rightLine = (right as LineKeys).line ?? (right as string)\n      return leftLine === rightLine\n    }\n  })\n\n  const newLines: LineKeys[] = []\n\n  lineDifferences\n    .filter((change) => change.added === undefined || !change.added)\n    .forEach((value) => {\n      if (value.removed) {\n        ;(value.value as string[]).forEach((line) => {\n          lastUsedLineId += 1\n          newLines.push({ line: line, id: lastUsedLineId })\n        })\n      } else {\n        ;(value.value as LineKeys[]).forEach((line) => newLines.push(line))\n      }\n    })\n\n  return { lines: newLines, lastUsedLineId: lastUsedLineId }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useEffect, useRef } from 'react'\nimport './abc.scss'\n\nexport interface AbcFrameProps {\n  code: string\n}\n\nexport const AbcFrame: React.FC<AbcFrameProps> = ({ code }) => {\n  const container = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (!container.current) {\n      return\n    }\n    const actualContainer = container.current\n    import(/* webpackChunkName: \"abc.js\" */ 'abcjs')\n      .then((imp) => {\n        imp.renderAbc(actualContainer, code, {})\n      })\n      .catch(() => {\n        console.error('error while loading abcjs')\n      })\n  }, [code])\n\n  return <div ref={container} className={'abcjs-score bg-white text-black svg-container'} />\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { AbcFrame } from './abc-frame'\n\n/**\n * Detects code blocks with \"abc\" as language and renders them as ABC.js\n */\nexport class AbcReplacer extends ComponentReplacer {\n  getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'abc' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    return <AbcFrame code={code} />\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\n\nexport const getAttributesFromHedgeDocTag = (node: Element, tagName: string): { [s: string]: string } | undefined => {\n  if (node.name !== `app-${tagName}` || !node.attribs) {\n    return\n  }\n  return node.attribs\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useEffect, useState } from 'react'\nimport { Trans } from 'react-i18next'\nimport { IconName } from '../../../common/fork-awesome/types'\nimport { ShowIf } from '../../../common/show-if/show-if'\nimport './one-click-embedding.scss'\nimport { ProxyImageFrame } from '../image/proxy-image-frame'\n\ninterface OneClickFrameProps {\n  onImageFetch?: () => Promise<string>\n  loadingImageUrl?: string\n  hoverIcon?: IconName\n  hoverTextI18nKey?: string\n  tooltip?: string\n  containerClassName?: string\n  previewContainerClassName?: string\n  onActivate?: () => void\n}\n\nexport const OneClickEmbedding: React.FC<OneClickFrameProps> = ({\n  previewContainerClassName,\n  containerClassName,\n  onImageFetch,\n  loadingImageUrl,\n  children,\n  tooltip,\n  hoverIcon,\n  hoverTextI18nKey,\n  onActivate\n}) => {\n  const [showFrame, setShowFrame] = useState(false)\n  const [previewImageUrl, setPreviewImageUrl] = useState(loadingImageUrl)\n\n  const showChildren = () => {\n    setShowFrame(true)\n    if (onActivate) {\n      onActivate()\n    }\n  }\n\n  useEffect(() => {\n    if (!onImageFetch) {\n      return\n    }\n    onImageFetch()\n      .then((imageLink) => {\n        setPreviewImageUrl(imageLink)\n      })\n      .catch((message) => {\n        console.error(message)\n      })\n  }, [onImageFetch])\n\n  return (\n    <span className={containerClassName}>\n      <ShowIf condition={showFrame}>{children}</ShowIf>\n      <ShowIf condition={!showFrame}>\n        <span className={`one-click-embedding ${previewContainerClassName || ''}`} onClick={showChildren}>\n          <ShowIf condition={!!previewImageUrl}>\n            <ProxyImageFrame\n              className={'one-click-embedding-preview'}\n              src={previewImageUrl}\n              alt={tooltip || ''}\n              title={tooltip || ''}\n            />\n          </ShowIf>\n          <ShowIf condition={!!hoverIcon}>\n            <span className='one-click-embedding-icon text-center'>\n              <i className={`fa fa-${hoverIcon as string} fa-5x mb-2`} />\n              <ShowIf condition={!!hoverTextI18nKey}>\n                <br />\n                <Trans i18nKey={hoverTextI18nKey} />\n              </ShowIf>\n            </span>\n          </ShowIf>\n        </span>\n      </ShowIf>\n    </span>\n  )\n}\n","/*\n SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n\n SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React from 'react'\nimport { OneClickEmbedding } from '../one-click-frame/one-click-embedding'\n\nexport interface AsciinemaFrameProps {\n  id: string\n}\n\nexport const AsciinemaFrame: React.FC<AsciinemaFrameProps> = ({ id }) => {\n  return (\n    <OneClickEmbedding\n      containerClassName={'embed-responsive embed-responsive-16by9'}\n      previewContainerClassName={'embed-responsive-item'}\n      hoverIcon={'play'}\n      loadingImageUrl={`https://asciinema.org/a/${id}.png`}>\n      <iframe\n        className='embed-responsive-item'\n        title={`asciinema cast ${id}`}\n        src={`https://asciinema.org/a/${id}/embed?autoplay=1`}\n      />\n    </OneClickEmbedding>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { RegexOptions } from '../../../../external-types/markdown-it-regex/interface'\n\nconst protocolRegex = /(?:http(?:s)?:\\/\\/)?/\nconst domainRegex = /(?:asciinema\\.org\\/a\\/)/\nconst idRegex = /(\\d+)/\nconst tailRegex = /(?:[./?#].*)?/\nconst gistUrlRegex = new RegExp(`(?:${protocolRegex.source}${domainRegex.source}${idRegex.source}${tailRegex.source})`)\nconst linkRegex = new RegExp(`^${gistUrlRegex.source}$`, 'i')\n\nexport const replaceAsciinemaLink: RegexOptions = {\n  name: 'asciinema-link',\n  regex: linkRegex,\n  replace: (match) => {\n    // ESLint wants to collapse this tag, but then the tag won't be valid html anymore.\n    // noinspection CheckTagEmptyBody\n    return `<app-asciinema id=\"${match}\"></app-asciinema>`\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport MarkdownIt from 'markdown-it'\nimport markdownItRegex from 'markdown-it-regex'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { getAttributesFromHedgeDocTag } from '../utils'\nimport { AsciinemaFrame } from './asciinema-frame'\nimport { replaceAsciinemaLink } from './replace-asciinema-link'\n\n/**\n * Detects code blocks with \"asciinema\" as language and renders them Asciinema frame\n */\nexport class AsciinemaReplacer extends ComponentReplacer {\n  public static readonly markdownItPlugin: MarkdownIt.PluginSimple = (markdownIt) => {\n    markdownItRegex(markdownIt, replaceAsciinemaLink)\n  }\n\n  public getReplacement(node: Element): React.ReactElement | undefined {\n    const attributes = getAttributesFromHedgeDocTag(node, 'asciinema')\n    if (attributes && attributes.id) {\n      const asciinemaId = attributes.id\n      return <AsciinemaFrame id={asciinemaId} />\n    }\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nexport const parseCsv = (csvText: string, csvColumnDelimiter: string): string[][] => {\n  const rows = csvText.split('\\n')\n  if (!rows || rows.length === 0) {\n    return []\n  }\n  const splitRegex = new RegExp(`${csvColumnDelimiter}(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)`)\n  return rows.filter((row) => row !== '').map((row) => row.split(splitRegex))\n}\n","/*\n SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n\n SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useMemo } from 'react'\nimport { parseCsv } from './csv-parser'\n\nexport interface CsvTableProps {\n  code: string\n  delimiter: string\n  showHeader: boolean\n  tableRowClassName?: string\n  tableColumnClassName?: string\n}\n\nexport const CsvTable: React.FC<CsvTableProps> = ({\n  code,\n  delimiter,\n  showHeader,\n  tableRowClassName,\n  tableColumnClassName\n}) => {\n  const { rowsWithColumns, headerRow } = useMemo(() => {\n    const rowsWithColumns = parseCsv(code.trim(), delimiter)\n    let headerRow: string[] = []\n    if (showHeader) {\n      headerRow = rowsWithColumns.splice(0, 1)[0]\n    }\n    return { rowsWithColumns, headerRow }\n  }, [code, delimiter, showHeader])\n\n  const renderTableHeader = (row: string[]) => {\n    if (row !== []) {\n      return (\n        <thead>\n          <tr>\n            {row.map((column, columnNumber) => (\n              <th key={`header-${columnNumber}`}>{column}</th>\n            ))}\n          </tr>\n        </thead>\n      )\n    }\n  }\n\n  const renderTableBody = (rows: string[][]) => {\n    return (\n      <tbody>\n        {rows.map((row, rowNumber) => (\n          <tr className={tableRowClassName} key={`row-${rowNumber}`}>\n            {row.map((column, columnIndex) => (\n              <td className={tableColumnClassName} key={`cell-${rowNumber}-${columnIndex}`}>\n                {column.replace(/^\"|\"$/g, '')}\n              </td>\n            ))}\n          </tr>\n        ))}\n      </tbody>\n    )\n  }\n\n  return (\n    <table className={'csv-html-table table-striped'}>\n      {renderTableHeader(headerRow)}\n      {renderTableBody(rowsWithColumns)}\n    </table>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { CsvTable } from './csv-table'\n\n/**\n * Detects code blocks with \"csv\" as language and renders them as table.\n */\nexport class CsvReplacer extends ComponentReplacer {\n  public getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'csv' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    const extraData = codeNode.attribs['data-extra']\n    const extraRegex = /\\s*(delimiter=([^\\s]*))?\\s*(header)?/\n    const extraInfos = extraRegex.exec(extraData)\n\n    let delimiter = ','\n    let showHeader = false\n\n    if (extraInfos) {\n      delimiter = extraInfos[2] || delimiter\n      showHeader = extraInfos[3] !== undefined\n    }\n\n    return <CsvTable code={code} delimiter={delimiter} showHeader={showHeader} />\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useEffect, useRef, useState } from 'react'\nimport { Alert } from 'react-bootstrap'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { useIsDarkModeActivated } from '../../../../../hooks/common/use-is-dark-mode-activated'\n\nexport interface FlowChartProps {\n  code: string\n}\n\nexport const FlowChart: React.FC<FlowChartProps> = ({ code }) => {\n  const diagramRef = useRef<HTMLDivElement>(null)\n  const [error, setError] = useState(false)\n  const darkModeActivated = useIsDarkModeActivated()\n\n  useTranslation()\n\n  useEffect(() => {\n    if (diagramRef.current === null) {\n      return\n    }\n    const currentDiagramRef = diagramRef.current\n    import(/* webpackChunkName: \"flowchart.js\" */ 'flowchart.js')\n      .then((imp) => {\n        const parserOutput = imp.parse(code)\n        try {\n          parserOutput.drawSVG(currentDiagramRef, {\n            'line-width': 2,\n            fill: 'none',\n            'font-size': 16,\n            'line-color': darkModeActivated ? '#ffffff' : '#000000',\n            'element-color': darkModeActivated ? '#ffffff' : '#000000',\n            'font-color': darkModeActivated ? '#ffffff' : '#000000',\n            'font-family': 'Source Sans Pro, \"Twemoji\", monospace'\n          })\n          setError(false)\n        } catch (error) {\n          setError(true)\n        }\n      })\n      .catch(() => console.error('error while loading flowchart.js'))\n\n    return () => {\n      Array.from(currentDiagramRef.children).forEach((value) => value.remove())\n    }\n  }, [code, darkModeActivated])\n\n  if (error) {\n    return (\n      <Alert variant={'danger'}>\n        <Trans i18nKey={'renderer.flowchart.invalidSyntax'} />\n      </Alert>\n    )\n  } else {\n    return <div ref={diagramRef} data-cy={'flowchart'} className={'text-center'} />\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { FlowChart } from './flowchart/flowchart'\n\n/**\n * Detects code blocks with \"flow\" as language and renders them as flow chart.\n */\nexport class FlowchartReplacer extends ComponentReplacer {\n  public getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'flow' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    return <FlowChart code={code} />\n  }\n}\n","/*\n SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n\n SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport './gist-frame.scss'\n\nexport interface GistFrameProps {\n  id: string\n}\n\ninterface resizeEvent {\n  size: number\n  id: string\n}\n\nexport const GistFrame: React.FC<GistFrameProps> = ({ id }) => {\n  const iframeHtml = useMemo(() => {\n    return `\n      <html lang=\"en\">\n        <head>\n          <base target=\"_parent\">\n          <title>gist</title>\n          <style>\n            * { font-size:12px; }\n            body{ overflow:hidden; margin: 0;}\n          </style>\n          <script type=\"text/javascript\">\n            function doLoad() {\n                window.parent.postMessage({eventType: 'gistResize', size: document.body.scrollHeight, id: '${id}'}, '*')\n                tweakLinks();\n            }\n            function tweakLinks() {\n                document.querySelectorAll(\".gist-meta > a\").forEach((link) => {\n                    link.rel=\"noopener noreferer\"\n                    link.target=\"_blank\"\n                })\n            }\n          </script>\n        </head>\n        <body onload=\"doLoad()\">\n          <script type=\"text/javascript\" src=\"https://gist.github.com/${id}.js\"></script>\n        </body>\n      </html>`\n  }, [id])\n\n  const [frameHeight, setFrameHeight] = useState(0)\n\n  const sizeMessage = useCallback(\n    (message: MessageEvent) => {\n      const data = message.data as resizeEvent\n      if (data.id !== id) {\n        return\n      }\n      setFrameHeight(data.size)\n    },\n    [id]\n  )\n\n  useEffect(() => {\n    window.addEventListener('message', sizeMessage)\n    return () => {\n      window.removeEventListener('message', sizeMessage)\n    }\n  }, [sizeMessage])\n\n  return (\n    <iframe\n      sandbox='allow-scripts allow-top-navigation-by-user-activation allow-popups'\n      data-cy={'gh-gist'}\n      width='100%'\n      height={`${frameHeight}px`}\n      frameBorder='0'\n      title={`gist ${id}`}\n      src={`data:text/html;base64,${btoa(iframeHtml)}`}\n    />\n  )\n}\n","export default __webpack_public_path__ + \"static/media/gist-preview.d7b810ad.png\";","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { RegexOptions } from '../../../../external-types/markdown-it-regex/interface'\n\nconst protocolRegex = /(?:http(?:s)?:\\/\\/)?/\nconst domainRegex = /(?:gist\\.github\\.com\\/)/\nconst idRegex = /(\\w+\\/\\w+)/\nconst tailRegex = /(?:[./?#].*)?/\nconst gistUrlRegex = new RegExp(`(?:${protocolRegex.source}${domainRegex.source}${idRegex.source}${tailRegex.source})`)\nconst linkRegex = new RegExp(`^${gistUrlRegex.source}$`, 'i')\n\nexport const replaceGistLink: RegexOptions = {\n  name: 'gist-link',\n  regex: linkRegex,\n  replace: (match) => {\n    // ESLint wants to collapse this tag, but then the tag won't be valid html anymore.\n    // noinspection CheckTagEmptyBody\n    return `<app-gist id=\"${match}\"></app-gist>`\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { RegexOptions } from '../../../../external-types/markdown-it-regex/interface'\n\nconst finalRegex = /^{%gist (\\w+\\/\\w+) ?%}$/\n\nexport const replaceLegacyGistShortCode: RegexOptions = {\n  name: 'legacy-gist-short-code',\n  regex: finalRegex,\n  replace: (match) => {\n    // ESLint wants to collapse this tag, but then the tag won't be valid html anymore.\n    // noinspection CheckTagEmptyBody\n    return `<app-gist id=\"${match}\"></app-gist>`\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport MarkdownIt from 'markdown-it'\nimport markdownItRegex from 'markdown-it-regex'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { OneClickEmbedding } from '../one-click-frame/one-click-embedding'\nimport { getAttributesFromHedgeDocTag } from '../utils'\nimport { GistFrame } from './gist-frame'\nimport preview from './gist-preview.png'\nimport { replaceGistLink } from './replace-gist-link'\nimport { replaceLegacyGistShortCode } from './replace-legacy-gist-short-code'\n\n/**\n * Detects \"app-gist\" tags and renders them as gist frames.\n */\nexport class GistReplacer extends ComponentReplacer {\n  public static readonly markdownItPlugin: MarkdownIt.PluginSimple = (markdownIt) => {\n    markdownItRegex(markdownIt, replaceGistLink)\n    markdownItRegex(markdownIt, replaceLegacyGistShortCode)\n  }\n\n  public getReplacement(node: Element): React.ReactElement | undefined {\n    const attributes = getAttributesFromHedgeDocTag(node, 'gist')\n    if (attributes && attributes.id) {\n      const gistId = attributes.id\n      return (\n        <OneClickEmbedding\n          previewContainerClassName={'gist-frame'}\n          loadingImageUrl={preview}\n          hoverIcon={'github'}\n          tooltip={'click to load gist'}>\n          <GistFrame id={gistId} />\n        </OneClickEmbedding>\n      )\n    }\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { Fragment, useCallback, useEffect, useRef, useState } from 'react'\nimport { Alert } from 'react-bootstrap'\nimport { ShowIf } from '../../../common/show-if/show-if'\nimport { useFrontendBaseUrl } from '../../../../hooks/common/use-frontend-base-url'\n\nexport interface GraphvizFrameProps {\n  code: string\n}\n\nexport const GraphvizFrame: React.FC<GraphvizFrameProps> = ({ code }) => {\n  const container = useRef<HTMLDivElement>(null)\n  const [error, setError] = useState<string>()\n\n  const showError = useCallback((error: string) => {\n    if (!container.current) {\n      return\n    }\n    setError(error)\n    console.error(error)\n    container.current.querySelectorAll('svg').forEach((child) => child.remove())\n  }, [])\n\n  const frontendBaseUrl = useFrontendBaseUrl()\n\n  useEffect(() => {\n    if (!container.current) {\n      return\n    }\n    const actualContainer = container.current\n\n    import(/* webpackChunkName: \"d3-graphviz\" */ '@hpcc-js/wasm')\n      .then((wasmPlugin) => {\n        wasmPlugin.wasmFolder(`${frontendBaseUrl}/static/js`)\n      })\n      .then(() => import(/* webpackChunkName: \"d3-graphviz\" */ 'd3-graphviz'))\n      .then((graphvizImport) => {\n        try {\n          setError(undefined)\n          graphvizImport\n            .graphviz(actualContainer, {\n              useWorker: false,\n              zoom: false\n            })\n            .onerror(showError)\n            .renderDot(code)\n        } catch (error) {\n          showError(error)\n        }\n      })\n      .catch(() => {\n        console.error('error while loading graphviz')\n      })\n  }, [code, error, frontendBaseUrl, showError])\n\n  return (\n    <Fragment>\n      <ShowIf condition={!!error}>\n        <Alert variant={'warning'}>{error}</Alert>\n      </ShowIf>\n      <div className={'svg-container'} data-cy={'graphviz'} ref={container} />\n    </Fragment>\n  )\n}\n\nexport default GraphvizFrame\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { GraphvizFrame } from './graphviz-frame'\n\n/**\n * Detects code blocks with \"graphviz\" as language and renders them as graphviz graph.\n */\nexport class GraphvizReplacer extends ComponentReplacer {\n  getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'graphviz' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    return <GraphvizFrame code={code} />\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { HighlightedCode } from './highlighted-code/highlighted-code'\n\n/**\n * Detects code blocks and renders them as highlighted code blocks\n */\nexport class HighlightedCodeReplacer extends ComponentReplacer {\n  private lastLineNumber = 0\n\n  public getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const language = codeNode.attribs['data-highlight-language']\n    const extraData = codeNode.attribs['data-extra']\n    const extraInfos = /(=(\\d+|\\+)?)?(!?)/.exec(extraData)\n\n    let showLineNumbers = false\n    let startLineNumberAttribute = ''\n    let wrapLines = false\n\n    if (extraInfos) {\n      showLineNumbers = extraInfos[1]?.startsWith('=') || false\n      startLineNumberAttribute = extraInfos[2]\n      wrapLines = extraInfos[3] === '!'\n    }\n\n    const startLineNumber =\n      startLineNumberAttribute === '+' ? this.lastLineNumber : parseInt(startLineNumberAttribute) || 1\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    if (showLineNumbers) {\n      this.lastLineNumber = startLineNumber + code.split('\\n').filter((line) => !!line).length\n    }\n\n    return (\n      <HighlightedCode\n        language={language}\n        startLineNumber={showLineNumbers ? startLineNumber : undefined}\n        wrapLines={wrapLines}\n        code={code}\n      />\n    )\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { ProxyImageFrame } from './proxy-image-frame'\n\nexport type ImageClickHandler = (event: React.MouseEvent<HTMLImageElement, MouseEvent>) => void\n\n/**\n * Detects image tags and loads them via image proxy if configured.\n */\nexport class ImageReplacer extends ComponentReplacer {\n  private readonly clickHandler?: ImageClickHandler\n\n  constructor(clickHandler?: ImageClickHandler) {\n    super()\n    this.clickHandler = clickHandler\n  }\n\n  public getReplacement(node: Element): React.ReactElement | undefined {\n    if (node.name === 'img' && node.attribs) {\n      return (\n        <ProxyImageFrame\n          id={node.attribs.id}\n          className={`${node.attribs.class} cursor-zoom-in`}\n          src={node.attribs.src}\n          alt={node.attribs.alt}\n          title={node.attribs.title}\n          width={node.attribs.width}\n          height={node.attribs.height}\n          onClick={this.clickHandler}\n        />\n      )\n    }\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element, isTag } from 'domhandler'\nimport MarkdownIt from 'markdown-it'\nimport mathJax from 'markdown-it-mathjax'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport './katex.scss'\n\n/**\n * Checks if the given node is a KaTeX block.\n *\n * @param node the node to check\n * @return The given node if it is a KaTeX block element, undefined otherwise.\n */\nconst getNodeIfKatexBlock = (node: Element): Element | undefined => {\n  if (node.name !== 'p' || !node.children || node.children.length === 0) {\n    return\n  }\n  return node.children.filter(isTag).find((subnode) => {\n    return subnode.name === 'app-katex' && subnode.attribs?.inline === undefined\n  })\n}\n\n/**\n * Checks if the given node is a KaTeX inline element.\n *\n * @param node the node to check\n * @return The given node if it is a KaTeX inline element, undefined otherwise.\n */\nconst getNodeIfInlineKatex = (node: Element): Element | undefined => {\n  return node.name === 'app-katex' && node.attribs?.inline !== undefined ? node : undefined\n}\n\nconst KaTeX = React.lazy(() => import(/* webpackChunkName: \"katex\" */ '@matejmazur/react-katex'))\n\n/**\n * Detects LaTeX syntax and renders it with KaTeX.\n */\nexport class KatexReplacer extends ComponentReplacer {\n  public static readonly markdownItPlugin: MarkdownIt.PluginSimple = mathJax({\n    beforeMath: '<app-katex>',\n    afterMath: '</app-katex>',\n    beforeInlineMath: '<app-katex inline>',\n    afterInlineMath: '</app-katex>',\n    beforeDisplayMath: '<app-katex>',\n    afterDisplayMath: '</app-katex>'\n  })\n\n  public getReplacement(node: Element): React.ReactElement | undefined {\n    const katex = getNodeIfKatexBlock(node) || getNodeIfInlineKatex(node)\n    if (katex?.children && katex.children[0]) {\n      const mathJaxContent = ComponentReplacer.extractTextChildContent(katex)\n      const isInline = katex.attribs?.inline !== undefined\n      return <KaTeX block={!isInline} math={mathJaxContent} errorColor={'#cc0000'} />\n    }\n  }\n}\n","/*\n SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n\n SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport { ComponentReplacer } from '../ComponentReplacer'\n\n/**\n * Detects line markers and suppresses them in the resulting DOM.\n */\nexport class LinemarkerReplacer extends ComponentReplacer {\n  public getReplacement(codeNode: Element): null | undefined {\n    return codeNode.name === 'app-linemarker' ? null : undefined\n  }\n}\n","/*\n SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n\n SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React from 'react'\nimport { Button } from 'react-bootstrap'\nimport { ForkAwesomeIcon } from '../fork-awesome/fork-awesome-icon'\n\nexport interface LockButtonProps {\n  locked: boolean\n  onLockedChanged: (newState: boolean) => void\n  title: string\n}\n\nexport const LockButton: React.FC<LockButtonProps> = ({ locked, onLockedChanged, title }) => {\n  return (\n    <Button variant='dark' size='sm' onClick={() => onLockedChanged(!locked)} title={title}>\n      {locked ? <ForkAwesomeIcon icon='lock' /> : <ForkAwesomeIcon icon='unlock' />}\n    </Button>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useEffect, useRef, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { LockButton } from '../../../common/lock-button/lock-button'\nimport '../../utils/button-inside.scss'\n\nexport interface MarkmapFrameProps {\n  code: string\n}\n\nconst blockHandler = (event: Event): void => {\n  event.stopPropagation()\n}\n\nexport const MarkmapFrame: React.FC<MarkmapFrameProps> = ({ code }) => {\n  const { t } = useTranslation()\n  const diagramContainer = useRef<HTMLDivElement>(null)\n  const [disablePanAndZoom, setDisablePanAndZoom] = useState(true)\n\n  useEffect(() => {\n    if (diagramContainer.current) {\n      if (disablePanAndZoom) {\n        diagramContainer.current.addEventListener('wheel', blockHandler, true)\n        diagramContainer.current.addEventListener('mousedown', blockHandler, true)\n        diagramContainer.current.addEventListener('click', blockHandler, true)\n        diagramContainer.current.addEventListener('dblclick', blockHandler, true)\n        diagramContainer.current.addEventListener('touchstart', blockHandler, true)\n      } else {\n        diagramContainer.current.removeEventListener('wheel', blockHandler, true)\n        diagramContainer.current.removeEventListener('mousedown', blockHandler, true)\n        diagramContainer.current.removeEventListener('click', blockHandler, true)\n        diagramContainer.current.removeEventListener('dblclick', blockHandler, true)\n        diagramContainer.current.removeEventListener('touchstart', blockHandler, true)\n      }\n    }\n  }, [diagramContainer, disablePanAndZoom])\n\n  useEffect(() => {\n    if (!diagramContainer.current) {\n      return\n    }\n    const actualContainer = diagramContainer.current\n    import(/* webpackChunkName: \"markmap\" */ './markmap-loader')\n      .then(({ markmapLoader }) => {\n        try {\n          const svg: SVGSVGElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n          svg.setAttribute('width', '100%')\n          actualContainer.querySelectorAll('svg').forEach((child) => child.remove())\n          actualContainer.appendChild(svg)\n          markmapLoader(svg, code)\n        } catch (error) {\n          console.error(error)\n        }\n      })\n      .catch(() => {\n        console.error('error while loading markmap')\n      })\n  }, [code])\n\n  return (\n    <div data-cy={'markmap'}>\n      <div className={'svg-container'} ref={diagramContainer} />\n      <div className={'text-right button-inside'}>\n        <LockButton\n          locked={disablePanAndZoom}\n          onLockedChanged={(newState) => setDisablePanAndZoom(newState)}\n          title={disablePanAndZoom ? t('renderer.markmap.locked') : t('renderer.markmap.unlocked')}\n        />\n      </div>\n    </div>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { MarkmapFrame } from './markmap-frame'\n\n/**\n * Detects code blocks with 'markmap' as language and renders them with Markmap.\n */\nexport class MarkmapReplacer extends ComponentReplacer {\n  getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'markmap' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    return <MarkmapFrame code={code} />\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { Fragment, useCallback, useEffect, useRef, useState } from 'react'\nimport { Alert } from 'react-bootstrap'\nimport { useTranslation } from 'react-i18next'\nimport { ShowIf } from '../../../common/show-if/show-if'\nimport './mermaid.scss'\n\nexport interface MermaidChartProps {\n  code: string\n}\n\ninterface MermaidParseError {\n  str: string\n}\n\nlet mermaidInitialized = false\n\nexport const MermaidChart: React.FC<MermaidChartProps> = ({ code }) => {\n  const diagramContainer = useRef<HTMLDivElement>(null)\n  const [error, setError] = useState<string>()\n  const { t } = useTranslation()\n\n  useEffect(() => {\n    if (!mermaidInitialized) {\n      import(/* webpackChunkName: \"mermaid\" */ 'mermaid')\n        .then((mermaid) => {\n          mermaid.default.initialize({ startOnLoad: false })\n          mermaidInitialized = true\n        })\n        .catch(() => {\n          console.error('error while loading mermaid')\n        })\n    }\n  }, [])\n\n  const showError = useCallback(\n    (error: string) => {\n      setError(error)\n      console.error(error)\n      if (!diagramContainer.current) {\n        return\n      }\n      diagramContainer.current.querySelectorAll('svg').forEach((child) => child.remove())\n    },\n    [setError]\n  )\n\n  useEffect(() => {\n    if (!diagramContainer.current) {\n      return\n    }\n    import(/* webpackChunkName: \"mermaid\" */ 'mermaid')\n      .then((mermaid) => {\n        try {\n          if (!diagramContainer.current) {\n            return\n          }\n          mermaid.default.parse(code)\n          delete diagramContainer.current.dataset.processed\n          diagramContainer.current.textContent = code\n          mermaid.default.init(diagramContainer.current)\n          setError(undefined)\n        } catch (error) {\n          const message = (error as MermaidParseError).str\n          showError(message || t('renderer.mermaid.unknownError'))\n        }\n      })\n      .catch(() => showError('Error while loading mermaid'))\n  }, [code, showError, t])\n\n  return (\n    <Fragment>\n      <ShowIf condition={!!error}>\n        <Alert variant={'warning'}>{error}</Alert>\n      </ShowIf>\n      <div className={'text-center mermaid text-black'} ref={diagramContainer} />\n    </Fragment>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { MermaidChart } from './mermaid-chart'\n\n/**\n * Detects code blocks with 'mermaid' as language and renders them with mermaid.\n */\nexport class MermaidReplacer extends ComponentReplacer {\n  getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'mermaid' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    return <MermaidChart code={code} />\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element, isTag } from 'domhandler'\nimport { ComponentReplacer, NativeRenderer, SubNodeTransform, ValidReactDomElement } from '../ComponentReplacer'\n\n/**\n * Checks if the given node is a blockquote color definition\n *\n * @param node The node to check\n * @return true if the checked node is a blockquote color definition\n */\nconst isBlockquoteColorDefinition = (node: Element | undefined): boolean => {\n  if (!node || !node.attribs || !node.attribs.class || !node.attribs['data-color']) {\n    return false\n  }\n  return node.name === 'span' && node.attribs.class === 'quote-extra'\n}\n\n/**\n * Checks if any of the given nodes is the parent element of a color extra element.\n *\n * @param nodes The array of nodes to check\n * @return the found element or undefined if no element was found\n */\nconst findBlockquoteColorParentElement = (nodes: Element[]): Element | undefined => {\n  return nodes.find((child) => {\n    if (child.name !== 'p' || !child.children || child.children.length < 1) {\n      return false\n    }\n    return child.children.filter(isTag).find(isBlockquoteColorDefinition) !== undefined\n  })\n}\n\n/**\n * Detects blockquotes and checks if they contain a color tag.\n * If a color tag was found then the color will be applied to the node as border.\n */\nexport class ColoredBlockquoteReplacer extends ComponentReplacer {\n  public getReplacement(\n    node: Element,\n    subNodeTransform: SubNodeTransform,\n    nativeRenderer: NativeRenderer\n  ): ValidReactDomElement | undefined {\n    if (node.name !== 'blockquote' || !node.children || node.children.length < 1) {\n      return\n    }\n    const paragraph = findBlockquoteColorParentElement(node.children.filter(isTag))\n    if (!paragraph) {\n      return\n    }\n    const childElements = paragraph.children || []\n    const optionsTag = childElements.filter(isTag).find(isBlockquoteColorDefinition)\n    if (!optionsTag) {\n      return\n    }\n    paragraph.children = childElements.filter((elem) => !isTag(elem) || !isBlockquoteColorDefinition(elem))\n    const attributes = optionsTag.attribs\n    if (!attributes || !attributes['data-color']) {\n      return\n    }\n    node.attribs = Object.assign(node.attribs || {}, { style: `border-left-color: ${attributes['data-color']};` })\n    return nativeRenderer()\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React from 'react'\nimport { Alert } from 'react-bootstrap'\nimport { Trans, useTranslation } from 'react-i18next'\nimport links from '../../../../links.json'\nimport { TranslatedExternalLink } from '../../../common/links/translated-external-link'\n\nexport const DeprecationWarning: React.FC = () => {\n  useTranslation()\n\n  return (\n    <Alert data-cy={'yaml'} className={'mt-2'} variant={'warning'}>\n      <span className={'text-wrap'}>\n        <Trans i18nKey={'renderer.sequence.deprecationWarning'} />\n      </span>\n      <br />\n      <TranslatedExternalLink i18nKey={'common.readForMoreInfo'} className={'text-primary'} href={links.faq} />\n    </Alert>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React, { Fragment } from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { MermaidChart } from '../mermaid/mermaid-chart'\nimport { DeprecationWarning } from './deprecation-warning'\n\n/**\n * Detects code blocks with 'sequence' as language and renders them as\n * sequence diagram with mermaid.\n */\nexport class SequenceDiagramReplacer extends ComponentReplacer {\n  getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'sequence' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    return (\n      <Fragment>\n        <DeprecationWarning />\n        <MermaidChart code={'sequenceDiagram\\n' + code} />\n      </Fragment>\n    )\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React, { ReactElement } from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\n\nexport type TaskCheckedChangeHandler = (lineInMarkdown: number, checked: boolean) => void\n\n/**\n * Detects task lists and renders them as checkboxes that execute a callback if clicked.\n */\nexport class TaskListReplacer extends ComponentReplacer {\n  onTaskCheckedChange?: (lineInMarkdown: number, checked: boolean) => void\n\n  constructor(onTaskCheckedChange?: TaskCheckedChangeHandler) {\n    super()\n    this.onTaskCheckedChange = onTaskCheckedChange\n  }\n\n  handleCheckboxChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n    const lineNum = Number(event.currentTarget.dataset.line)\n    if (this.onTaskCheckedChange) {\n      this.onTaskCheckedChange(lineNum, event.currentTarget.checked)\n    }\n  }\n\n  public getReplacement(node: Element): ReactElement | undefined {\n    if (node.attribs?.class !== 'task-list-item-checkbox') {\n      return\n    }\n    return (\n      <input\n        disabled={this.onTaskCheckedChange === undefined}\n        className='task-list-item-checkbox'\n        type='checkbox'\n        checked={node.attribs.checked !== undefined}\n        onChange={this.handleCheckboxChange}\n        id={node.attribs.id}\n        data-line={node.attribs['data-line']}\n      />\n    )\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { Fragment, useCallback, useEffect, useRef, useState } from 'react'\nimport { Alert } from 'react-bootstrap'\nimport { useTranslation } from 'react-i18next'\nimport { VisualizationSpec } from 'vega-embed'\nimport { ShowIf } from '../../../common/show-if/show-if'\n\nexport interface VegaChartProps {\n  code: string\n}\n\nexport const VegaChart: React.FC<VegaChartProps> = ({ code }) => {\n  const diagramContainer = useRef<HTMLDivElement>(null)\n  const [error, setError] = useState<string>()\n  const { t } = useTranslation()\n\n  const showError = useCallback((error: string) => {\n    if (!diagramContainer.current) {\n      return\n    }\n    console.error(error)\n    setError(error)\n  }, [])\n\n  useEffect(() => {\n    if (!diagramContainer.current) {\n      return\n    }\n    import(/* webpackChunkName: \"vega\" */ 'vega-embed')\n      .then((embed) => {\n        try {\n          if (!diagramContainer.current) {\n            return\n          }\n\n          const spec = JSON.parse(code) as VisualizationSpec\n          embed\n            .default(diagramContainer.current, spec, {\n              actions: {\n                export: true,\n                source: false,\n                compiled: false,\n                editor: false\n              },\n              i18n: {\n                PNG_ACTION: t('renderer.vega-lite.png'),\n                SVG_ACTION: t('renderer.vega-lite.svg')\n              }\n            })\n            .then(() => setError(undefined))\n            .catch((error: Error) => showError(error.message))\n        } catch (error) {\n          showError(t('renderer.vega-lite.errorJson'))\n        }\n      })\n      .catch(() => {\n        console.error('error while loading vega-light')\n      })\n  }, [code, showError, t])\n\n  return (\n    <Fragment>\n      <ShowIf condition={!!error}>\n        <Alert variant={'danger'}>{error}</Alert>\n      </ShowIf>\n      <div className={'text-center'}>\n        <div ref={diagramContainer} />\n      </div>\n    </Fragment>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { VegaChart } from './vega-chart'\n\n/**\n * Detects code blocks with 'vega-lite' as language and renders them with Vega.\n */\nexport class VegaReplacer extends ComponentReplacer {\n  getReplacement(codeNode: Element): React.ReactElement | undefined {\n    if (\n      codeNode.name !== 'code' ||\n      !codeNode.attribs ||\n      !codeNode.attribs['data-highlight-language'] ||\n      codeNode.attribs['data-highlight-language'] !== 'vega-lite' ||\n      !codeNode.children ||\n      !codeNode.children[0]\n    ) {\n      return\n    }\n\n    const code = ComponentReplacer.extractTextChildContent(codeNode)\n\n    return <VegaChart code={code} />\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { RegexOptions } from '../../../../external-types/markdown-it-regex/interface'\n\nexport const replaceLegacyVimeoShortCode: RegexOptions = {\n  name: 'legacy-vimeo-short-code',\n  regex: /^{%vimeo ([\\d]{6,11}) ?%}$/,\n  replace: (match) => {\n    // ESLint wants to collapse this tag, but then the tag won't be valid html anymore.\n    // noinspection CheckTagEmptyBody\n    return `<app-vimeo id=\"${match}\"></app-vimeo>`\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { RegexOptions } from '../../../../external-types/markdown-it-regex/interface'\n\nconst protocolRegex = /(?:http(?:s)?:\\/\\/)?/\nconst domainRegex = /(?:player\\.)?(?:vimeo\\.com\\/)(?:(?:channels|album|ondemand|groups)\\/\\w+\\/)?(?:video\\/)?/\nconst idRegex = /([\\d]{6,11})/\nconst tailRegex = /(?:[?#].*)?/\nconst vimeoVideoUrlRegex = new RegExp(\n  `(?:${protocolRegex.source}${domainRegex.source}${idRegex.source}${tailRegex.source})`\n)\nconst linkRegex = new RegExp(`^${vimeoVideoUrlRegex.source}$`, 'i')\n\nexport const replaceVimeoLink: RegexOptions = {\n  name: 'vimeo-link',\n  regex: linkRegex,\n  replace: (match) => {\n    // ESLint wants to collapse this tag, but then the tag won't be valid html anymore.\n    // noinspection CheckTagEmptyBody\n    return `<app-vimeo id=\"${match}\"></app-vimeo>`\n  }\n}\n","/*\n SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n\n SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useCallback } from 'react'\nimport { OneClickEmbedding } from '../one-click-frame/one-click-embedding'\n\ninterface VimeoApiResponse {\n  // Vimeo uses strange names for their fields. ESLint doesn't like that.\n  // eslint-disable-next-line camelcase\n  thumbnail_large?: string\n}\n\nexport interface VimeoFrameProps {\n  id: string\n}\n\nexport const VimeoFrame: React.FC<VimeoFrameProps> = ({ id }) => {\n  const getPreviewImageLink = useCallback(async () => {\n    const response = await fetch(`https://vimeo.com/api/v2/video/${id}.json`, {\n      credentials: 'omit',\n      referrerPolicy: 'no-referrer'\n    })\n    if (response.status !== 200) {\n      throw new Error('Error while loading data from vimeo api')\n    }\n    const vimeoResponse: VimeoApiResponse[] = (await response.json()) as VimeoApiResponse[]\n\n    if (vimeoResponse[0] && vimeoResponse[0].thumbnail_large) {\n      return vimeoResponse[0].thumbnail_large\n    } else {\n      throw new Error('Invalid vimeo response')\n    }\n  }, [id])\n\n  return (\n    <OneClickEmbedding\n      containerClassName={'embed-responsive embed-responsive-16by9'}\n      previewContainerClassName={'embed-responsive-item'}\n      loadingImageUrl={'https://i.vimeocdn.com/video/'}\n      hoverIcon={'vimeo-square'}\n      onImageFetch={getPreviewImageLink}>\n      <iframe\n        className='embed-responsive-item'\n        title={`vimeo video of ${id}`}\n        src={`https://player.vimeo.com/video/${id}?autoplay=1`}\n        allow='accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture'\n      />\n    </OneClickEmbedding>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport MarkdownIt from 'markdown-it'\nimport markdownItRegex from 'markdown-it-regex'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { getAttributesFromHedgeDocTag } from '../utils'\nimport { replaceLegacyVimeoShortCode } from './replace-legacy-vimeo-short-code'\nimport { replaceVimeoLink } from './replace-vimeo-link'\nimport { VimeoFrame } from './vimeo-frame'\n\n/**\n * Detects 'app-vimeo' tags and renders them as vimeo embedding.\n */\nexport class VimeoReplacer extends ComponentReplacer {\n  public static readonly markdownItPlugin: MarkdownIt.PluginSimple = (markdownIt) => {\n    markdownItRegex(markdownIt, replaceVimeoLink)\n    markdownItRegex(markdownIt, replaceLegacyVimeoShortCode)\n  }\n\n  public getReplacement(node: Element): React.ReactElement | undefined {\n    const attributes = getAttributesFromHedgeDocTag(node, 'vimeo')\n    if (attributes && attributes.id) {\n      const videoId = attributes.id\n      return <VimeoFrame id={videoId} />\n    }\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { RegexOptions } from '../../../../external-types/markdown-it-regex/interface'\n\nexport const replaceLegacyYoutubeShortCode: RegexOptions = {\n  name: 'legacy-youtube-short-code',\n  regex: /^{%youtube ([^\"&?\\\\/\\s]{11}) ?%}$/,\n  replace: (match) => {\n    // ESLint wants to collapse this tag, but then the tag won't be valid html anymore.\n    // noinspection CheckTagEmptyBody\n    return `<app-youtube id=\"${match}\"></app-youtube>`\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { RegexOptions } from '../../../../external-types/markdown-it-regex/interface'\n\nconst protocolRegex = /(?:http(?:s)?:\\/\\/)?/\nconst subdomainRegex = /(?:www.)?/\nconst pathRegex = /(?:youtube(?:-nocookie)?\\.com\\/(?:[^\\\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)/\nconst idRegex = /([^\"&?\\\\/\\s]{11})/\nconst tailRegex = /(?:[?&#].*)?/\nconst youtubeVideoUrlRegex = new RegExp(\n  `(?:${protocolRegex.source}${subdomainRegex.source}${pathRegex.source}${idRegex.source}${tailRegex.source})`\n)\nconst linkRegex = new RegExp(`^${youtubeVideoUrlRegex.source}$`, 'i')\n\nexport const replaceYouTubeLink: RegexOptions = {\n  name: 'youtube-link',\n  regex: linkRegex,\n  replace: (match) => {\n    // ESLint wants to collapse this tag, but then the tag won't be valid html anymore.\n    // noinspection CheckTagEmptyBody\n    return `<app-youtube id=\"${match}\"></app-youtube>`\n  }\n}\n","/*\n SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n\n SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React from 'react'\nimport { OneClickEmbedding } from '../one-click-frame/one-click-embedding'\n\nexport interface YouTubeFrameProps {\n  id: string\n}\n\nexport const YouTubeFrame: React.FC<YouTubeFrameProps> = ({ id }) => {\n  return (\n    <OneClickEmbedding\n      containerClassName={'embed-responsive embed-responsive-16by9'}\n      previewContainerClassName={'embed-responsive-item'}\n      hoverIcon={'youtube-play'}\n      loadingImageUrl={`https://i.ytimg.com/vi/${id}/maxresdefault.jpg`}>\n      <iframe\n        className='embed-responsive-item'\n        title={`youtube video of ${id}`}\n        src={`https://www.youtube-nocookie.com/embed/${id}?autoplay=1`}\n        allow='accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture'\n      />\n    </OneClickEmbedding>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element } from 'domhandler'\nimport MarkdownIt from 'markdown-it'\nimport markdownItRegex from 'markdown-it-regex'\nimport React from 'react'\nimport { ComponentReplacer } from '../ComponentReplacer'\nimport { getAttributesFromHedgeDocTag } from '../utils'\nimport { replaceLegacyYoutubeShortCode } from './replace-legacy-youtube-short-code'\nimport { replaceYouTubeLink } from './replace-youtube-link'\nimport { YouTubeFrame } from './youtube-frame'\n\n/**\n * Detects 'app-youtube' tags and renders them as youtube embedding.\n */\nexport class YoutubeReplacer extends ComponentReplacer {\n  public static readonly markdownItPlugin: MarkdownIt.PluginSimple = (markdownIt) => {\n    markdownItRegex(markdownIt, replaceYouTubeLink)\n    markdownItRegex(markdownIt, replaceLegacyYoutubeShortCode)\n  }\n\n  public getReplacement(node: Element): React.ReactElement | undefined {\n    const attributes = getAttributesFromHedgeDocTag(node, 'youtube')\n    if (attributes && attributes.id) {\n      const videoId = attributes.id\n      return <YouTubeFrame id={videoId} />\n    }\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { useCallback } from 'react'\nimport { AbcReplacer } from '../replace-components/abc/abc-replacer'\nimport { AsciinemaReplacer } from '../replace-components/asciinema/asciinema-replacer'\nimport { ComponentReplacer } from '../replace-components/ComponentReplacer'\nimport { CsvReplacer } from '../replace-components/csv/csv-replacer'\nimport { FlowchartReplacer } from '../replace-components/flow/flowchart-replacer'\nimport { GistReplacer } from '../replace-components/gist/gist-replacer'\nimport { GraphvizReplacer } from '../replace-components/graphviz/graphviz-replacer'\nimport { HighlightedCodeReplacer } from '../replace-components/highlighted-fence/highlighted-fence-replacer'\nimport { ImageClickHandler, ImageReplacer } from '../replace-components/image/image-replacer'\nimport { KatexReplacer } from '../replace-components/katex/katex-replacer'\nimport { LinemarkerReplacer } from '../replace-components/linemarker/linemarker-replacer'\nimport { LinkReplacer } from '../replace-components/link-replacer/link-replacer'\nimport { MarkmapReplacer } from '../replace-components/markmap/markmap-replacer'\nimport { MermaidReplacer } from '../replace-components/mermaid/mermaid-replacer'\nimport { ColoredBlockquoteReplacer } from '../replace-components/colored-blockquote/colored-blockquote-replacer'\nimport { SequenceDiagramReplacer } from '../replace-components/sequence-diagram/sequence-diagram-replacer'\nimport { TaskCheckedChangeHandler, TaskListReplacer } from '../replace-components/task-list/task-list-replacer'\nimport { VegaReplacer } from '../replace-components/vega-lite/vega-replacer'\nimport { VimeoReplacer } from '../replace-components/vimeo/vimeo-replacer'\nimport { YoutubeReplacer } from '../replace-components/youtube/youtube-replacer'\n\n/**\n * Provides a function that creates a list of {@link ComponentReplacer component replacer} instances.\n *\n * @param onTaskCheckedChange A callback that gets executed if a task checkbox gets clicked\n * @param onImageClick A callback that should be executed if an image gets clicked\n * @param baseUrl The base url for relative links\n *\n * @return the created list\n */\nexport const useComponentReplacers = (\n  onTaskCheckedChange?: TaskCheckedChangeHandler,\n  onImageClick?: ImageClickHandler,\n  baseUrl?: string\n): (() => ComponentReplacer[]) =>\n  useCallback(\n    () => [\n      new LinemarkerReplacer(),\n      new GistReplacer(),\n      new YoutubeReplacer(),\n      new VimeoReplacer(),\n      new AsciinemaReplacer(),\n      new AbcReplacer(),\n      new ImageReplacer(onImageClick),\n      new SequenceDiagramReplacer(),\n      new CsvReplacer(),\n      new FlowchartReplacer(),\n      new MermaidReplacer(),\n      new GraphvizReplacer(),\n      new MarkmapReplacer(),\n      new VegaReplacer(),\n      new HighlightedCodeReplacer(),\n      new ColoredBlockquoteReplacer(),\n      new KatexReplacer(),\n      new TaskListReplacer(onTaskCheckedChange),\n      new LinkReplacer(baseUrl)\n    ],\n    [onImageClick, onTaskCheckedChange, baseUrl]\n  )\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport equal from 'fast-deep-equal'\nimport { RefObject, useCallback, useEffect, useRef } from 'react'\nimport useResizeObserver from 'use-resize-observer'\nimport { LineMarkerPosition } from '../types'\nimport { LineMarkers } from '../replace-components/linemarker/line-number-marker'\n\nexport const calculateLineMarkerPositions = (\n  documentElement: HTMLDivElement,\n  currentLineMarkers: LineMarkers[],\n  offset?: number\n): LineMarkerPosition[] => {\n  const lineMarkers = currentLineMarkers\n  const children: HTMLCollection = documentElement.children\n  const lineMarkerPositions: LineMarkerPosition[] = []\n\n  Array.from(children).forEach((child, childIndex) => {\n    const htmlChild = child as HTMLElement\n    if (htmlChild.offsetTop === undefined) {\n      return\n    }\n    const currentLineMarker = lineMarkers[childIndex]\n    if (currentLineMarker === undefined) {\n      return\n    }\n\n    const lastPosition = lineMarkerPositions[lineMarkerPositions.length - 1]\n    if (!lastPosition || lastPosition.line !== currentLineMarker.startLine) {\n      lineMarkerPositions.push({\n        line: currentLineMarker.startLine,\n        position: htmlChild.offsetTop + (offset ?? 0)\n      })\n    }\n\n    lineMarkerPositions.push({\n      line: currentLineMarker.endLine,\n      position: htmlChild.offsetTop + htmlChild.offsetHeight + (offset ?? 0)\n    })\n  })\n\n  return lineMarkerPositions\n}\n\nexport const useCalculateLineMarkerPosition = (\n  documentElement: RefObject<HTMLDivElement>,\n  lineMarkers?: LineMarkers[],\n  onLineMarkerPositionChanged?: (lineMarkerPosition: LineMarkerPosition[]) => void,\n  offset?: number\n): void => {\n  const lastLineMarkerPositions = useRef<LineMarkerPosition[]>()\n\n  const calculateNewLineMarkerPositions = useCallback(() => {\n    if (!documentElement.current || !onLineMarkerPositionChanged || !lineMarkers) {\n      return\n    }\n\n    const newLines = calculateLineMarkerPositions(documentElement.current, lineMarkers, offset)\n\n    if (!equal(newLines, lastLineMarkerPositions)) {\n      lastLineMarkerPositions.current = newLines\n      onLineMarkerPositionChanged(newLines)\n    }\n  }, [documentElement, lineMarkers, offset, onLineMarkerPositionChanged])\n\n  useEffect(() => {\n    calculateNewLineMarkerPositions()\n  }, [calculateNewLineMarkerPositions])\n\n  useResizeObserver({\n    ref: documentElement,\n    onResize: () => calculateNewLineMarkerPositions()\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport equal from 'fast-deep-equal'\nimport { MutableRefObject, useEffect, useRef } from 'react'\n\nexport const useOnRefChange = <T>(\n  reference: MutableRefObject<T | undefined>,\n  onChange?: (newValue?: T) => void\n): void => {\n  const lastValue = useRef<T | undefined>()\n  useEffect(() => {\n    if (onChange && !equal(reference, lastValue.current)) {\n      lastValue.current = reference.current\n      onChange(reference.current)\n    }\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\nimport linkify from 'markdown-it/lib/rules_core/linkify'\n\nexport const linkifyExtra: MarkdownIt.PluginSimple = (md) => {\n  md.core.ruler.push('linkify', (state) => {\n    try {\n      state.md.options.linkify = true\n      return linkify(state)\n    } finally {\n      state.md.options.linkify = false\n    }\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\n\nexport const MarkdownItParserDebugger: MarkdownIt.PluginSimple = (md: MarkdownIt) => {\n  if (process.env.NODE_ENV !== 'production') {\n    md.core.ruler.push('test', (state) => {\n      console.log(state)\n      return false\n    })\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it'\nimport { escapeHtml } from 'markdown-it/lib/common/utils'\nimport markdownItContainer from 'markdown-it-container'\nimport Token from 'markdown-it/lib/token'\nimport { MarkdownItPlugin } from '../replace-components/ComponentReplacer'\nimport { RenderContainerReturn } from './alert-container'\n\nexport const spoilerRegEx = /^spoiler\\s+(.*)$/\n\nconst createSpoilerContainer = (): RenderContainerReturn => {\n  return (tokens: Token[], index: number) => {\n    const matches = spoilerRegEx.exec(tokens[index].info.trim())\n\n    if (tokens[index].nesting === 1 && matches && matches[1]) {\n      // opening tag\n      return `<details><summary>${escapeHtml(matches[1])}</summary>`\n    } else {\n      // closing tag\n      return '</details>\\n'\n    }\n  }\n}\n\nexport const spoilerContainer: MarkdownItPlugin = (markdownIt: MarkdownIt) => {\n  markdownItContainer(markdownIt, 'spoiler', {\n    validate: (params: string) => spoilerRegEx.test(params),\n    render: createSpoilerContainer()\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport markdownItTaskLists from '@hedgedoc/markdown-it-task-lists'\nimport MarkdownIt from 'markdown-it'\n\nexport const tasksLists: MarkdownIt.PluginSimple = (markdownIt) => {\n  markdownItTaskLists(markdownIt, {\n    enabled: true,\n    label: true,\n    lineNumber: true\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport emojiData from 'emoji-picker-element-data/en/emojibase/data.json'\nimport { ForkAwesomeIcons } from '../../../editor-page/editor-pane/tool-bar/emoji-picker/icon-names'\n\ninterface EmojiEntry {\n  shortcodes: string[]\n  emoji: string\n}\n\ntype ShortCodeMap = { [key: string]: string }\n\nconst shortCodeMap = (emojiData as unknown as EmojiEntry[]).reduce((reduceObject, emoji) => {\n  emoji.shortcodes.forEach((shortcode) => {\n    reduceObject[shortcode] = emoji.emoji\n  })\n  return reduceObject\n}, {} as ShortCodeMap)\n\nconst emojiSkinToneModifierMap = [1, 2, 3, 4, 5].reduce((reduceObject, modifierValue) => {\n  const lightSkinCode = 127995\n  const codepoint = lightSkinCode + (modifierValue - 1)\n  const shortcode = `skin-tone-${modifierValue}`\n  reduceObject[shortcode] = `&#${codepoint};`\n  return reduceObject\n}, {} as ShortCodeMap)\n\nconst forkAwesomeIconMap = Object.keys(ForkAwesomeIcons).reduce((reduceObject, icon) => {\n  const shortcode = `fa-${icon}`\n  // noinspection CheckTagEmptyBody\n  reduceObject[shortcode] = `<i class=\"fa fa-${icon}\"></i>`\n  return reduceObject\n}, {} as ShortCodeMap)\n\nexport const combinedEmojiData = {\n  ...shortCodeMap,\n  ...emojiSkinToneModifierMap,\n  ...forkAwesomeIconMap\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it'\nimport emoji from 'markdown-it-emoji/bare'\nimport { combinedEmojiData } from './emoji/mapping'\n\nexport const twitterEmojis: MarkdownIt.PluginSimple = (markdownIt) => {\n  emoji(markdownIt, {\n    defs: combinedEmojiData\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport plantuml from 'markdown-it-plantuml'\nimport MarkdownIt, { Options } from 'markdown-it/lib'\nimport Renderer, { RenderRule } from 'markdown-it/lib/renderer'\nimport Token from 'markdown-it/lib/token'\nimport { store } from '../../../redux'\nimport { MarkdownItPlugin } from '../replace-components/ComponentReplacer'\n\nexport const plantumlWithError: MarkdownItPlugin = (markdownIt: MarkdownIt) => {\n  const plantumlServer = store.getState().config.plantumlServer\n  if (plantumlServer) {\n    plantuml(markdownIt, {\n      openMarker: '```plantuml',\n      closeMarker: '```',\n      server: plantumlServer\n    })\n  } else {\n    plantumlError(markdownIt)\n  }\n}\n\nconst plantumlError: MarkdownIt.PluginSimple = (md) => {\n  const defaultRenderer: RenderRule = md.renderer.rules.fence || (() => '')\n  md.renderer.rules.fence = (tokens: Token[], idx: number, options: Options, env, slf: Renderer) => {\n    const token = tokens[idx]\n    if (token.info === 'plantuml') {\n      return `\n        <p class=\"alert alert-danger\">\n          PlantUML plugin is enabled but not properly configured.\n        </p>\n      `\n    }\n    return defaultRenderer(tokens, idx, options, env, slf)\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it'\nimport anchor from 'markdown-it-anchor'\n\nexport const headlineAnchors: MarkdownIt.PluginSimple = (markdownIt) => {\n  const options: anchor.AnchorOptions = {\n    permalink: true,\n    permalinkBefore: true,\n    permalinkClass: 'heading-anchor text-dark',\n    permalinkSymbol: '<i class=\"fa fa-link\"></i>',\n    permalinkHref: (slug: string): string => `#${slug}`\n  }\n\n  anchor(markdownIt, options)\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport markdownItRegex from 'markdown-it-regex'\nimport MarkdownIt from 'markdown-it/lib'\n\nconst finalRegex = /^{%pdf (.*) ?%}$/\n\nexport const legacyPdfShortCode: MarkdownIt.PluginSimple = (markdownIt) => {\n  markdownItRegex(markdownIt, {\n    name: 'legacy-pdf-short-code',\n    regex: finalRegex,\n    replace: (match: string) => {\n      return `<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"${match}\">${match}</a>`\n    }\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport markdownItRegex from 'markdown-it-regex'\nimport MarkdownIt from 'markdown-it/lib'\n\nconst finalRegex = /^{%slideshare (\\w+\\/[\\w-]+) ?%}$/\n\nexport const legacySlideshareShortCode: MarkdownIt.PluginSimple = (markdownIt) => {\n  markdownItRegex(markdownIt, {\n    name: 'legacy-slideshare-short-code',\n    regex: finalRegex,\n    replace: (match: string) => {\n      return `<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.slideshare.net/${match}\">https://www.slideshare.net/${match}</a>`\n    }\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport markdownItRegex from 'markdown-it-regex'\nimport MarkdownIt from 'markdown-it/lib'\n\nconst finalRegex = /^{%speakerdeck (\\w+\\/[\\w-]+) ?%}$/\n\nexport const legacySpeakerdeckShortCode: MarkdownIt.PluginSimple = (markdownIt) => {\n  markdownItRegex(markdownIt, {\n    name: 'legacy-speakerdeck-short-code',\n    regex: finalRegex,\n    replace: (match: string) => {\n      return `<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://speakerdeck.com/${match}\">https://speakerdeck.com/${match}</a>`\n    }\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\n\nconst highlightRegex = /^ *([\\w-]*)(.*)$/\n\nexport const highlightedCode: MarkdownIt.PluginSimple = (md: MarkdownIt) => {\n  md.core.ruler.push('highlighted-code', (state) => {\n    state.tokens.forEach((token) => {\n      if (token.type === 'fence') {\n        const highlightInfos = highlightRegex.exec(token.info)\n        if (!highlightInfos) {\n          return\n        }\n        if (highlightInfos[1]) {\n          token.attrJoin('data-highlight-language', highlightInfos[1])\n        }\n        if (highlightInfos[2]) {\n          token.attrJoin('data-extra', highlightInfos[2])\n        }\n      }\n    })\n    return true\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\nimport Token from 'markdown-it/lib/token'\nimport { IconName } from '../../common/fork-awesome/types'\n\nexport const quoteExtra: (quoteLabel: string, icon: IconName) => MarkdownIt.PluginSimple =\n  (quoteLabel: string, icon: IconName) => (md) => {\n    md.inline.ruler.push(`extraQuote_${quoteLabel}`, (state) => {\n      const quoteExtraTagValues = parseQuoteExtraTag(state.src, state.pos, state.posMax)\n\n      if (!quoteExtraTagValues || quoteExtraTagValues.label !== quoteLabel) {\n        return false\n      }\n      state.pos = quoteExtraTagValues.valueEndIndex + 1\n\n      const tokens: Token[] = []\n      state.md.inline.parse(quoteExtraTagValues.value, state.md, state.env, tokens)\n\n      const token = state.push('quote-extra', '', 0)\n      token.attrSet('icon', icon)\n      token.children = tokens\n\n      return true\n    })\n\n    if (md.renderer.rules['quote-extra']) {\n      return\n    }\n\n    md.renderer.rules['quote-extra'] = (tokens, idx, options: MarkdownIt.Options, env: unknown) => {\n      const token = tokens[idx]\n      const innerTokens = token.children\n\n      if (!innerTokens) {\n        return ''\n      }\n\n      const innerHtml = md.renderer.renderInline(innerTokens, options, env)\n      return `<span class=\"quote-extra\"><i class=\"fa fa-${token.attrGet('icon') ?? ''} mx-1\"></i>${innerHtml}</span>`\n    }\n  }\n\nexport interface QuoteExtraTagValues {\n  labelStartIndex: number\n  labelEndIndex: number\n  valueStartIndex: number\n  valueEndIndex: number\n  label: string\n  value: string\n}\n\nexport const parseQuoteExtraTag = (line: string, start: number, maxPos: number): QuoteExtraTagValues | undefined => {\n  if (line[start] !== '[') {\n    return\n  }\n\n  const labelStartIndex = start + 1\n  const labelEndIndex = parseLabel(line, labelStartIndex, maxPos)\n  if (!labelEndIndex || labelStartIndex === labelEndIndex) {\n    return\n  }\n\n  const valueStartIndex = labelEndIndex + 1\n  const valueEndIndex = parseValue(line, valueStartIndex, maxPos)\n  if (!valueEndIndex || valueStartIndex === valueEndIndex) {\n    return\n  }\n\n  return {\n    labelStartIndex,\n    labelEndIndex,\n    valueStartIndex,\n    valueEndIndex,\n    label: line.substr(labelStartIndex, labelEndIndex - labelStartIndex),\n    value: line.substr(valueStartIndex, valueEndIndex - valueStartIndex)\n  }\n}\n\nconst parseValue = (line: string, start: number, maxPos: number): number | undefined => {\n  let level = 1\n  for (let pos = start; pos <= maxPos; pos += 1) {\n    const currentCharacter = line[pos]\n    if (currentCharacter === ']') {\n      level -= 1\n      if (level === 0) {\n        return pos\n      }\n    } else if (currentCharacter === '[') {\n      level += 1\n    }\n  }\n}\n\nconst parseLabel = (line: string, start: number, maxPos: number): number | undefined => {\n  for (let pos = start; pos <= maxPos; pos += 1) {\n    if (line[pos] === '=') {\n      return pos\n    }\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\nimport { parseQuoteExtraTag } from './quote-extra'\n\nconst cssColorRegex =\n  /(#(?:[0-9a-f]{2}){2,4}|(?:#[0-9a-f]{3})|black|silver|gray|whitesmoke|maroon|red|purple|fuchsia|green|lime|olivedrab|yellow|navy|blue|teal|aquamarine|orange|aliceblue|antiquewhite|aqua|azure|beige|bisque|blanchedalmond|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|currentcolor|darkblue|darkcyan|darkgoldenrod|darkgray|darkgreen|darkgrey|darkkhaki|darkmagenta|darkolivegreen|darkorange|darkorchid|darkred|darksalmon|darkseagreen|darkslateblue|darkslategray|darkslategrey|darkturquoise|darkviolet|deeppink|deepskyblue|dimgray|dimgrey|dodgerblue|firebrick|floralwhite|forestgreen|gainsboro|ghostwhite|goldenrod|gold|greenyellow|grey|honeydew|hotpink|indianred|indigo|ivory|khaki|lavenderblush|lavender|lawngreen|lemonchiffon|lightblue|lightcoral|lightcyan|lightgoldenrodyellow|lightgray|lightgreen|lightgrey|lightpink|lightsalmon|lightseagreen|lightskyblue|lightslategray|lightslategrey|lightsteelblue|lightyellow|limegreen|linen|mediumaquamarine|mediumblue|mediumorchid|mediumpurple|mediumseagreen|mediumslateblue|mediumspringgreen|mediumturquoise|mediumvioletred|midnightblue|mintcream|mistyrose|moccasin|navajowhite|oldlace|olive|orangered|orchid|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|rebeccapurple|rosybrown|royalblue|saddlebrown|salmon|sandybrown|seagreen|seashell|sienna|skyblue|slateblue|slategray|slategrey|snow|springgreen|steelblue|tan|thistle|tomato|transparent|turquoise|violet|wheat|white|yellowgreen)/i\n\nexport const quoteExtraColor: MarkdownIt.PluginSimple = (md) => {\n  md.inline.ruler.push(`extraQuote_color`, (state) => {\n    const quoteExtraTagValues = parseQuoteExtraTag(state.src, state.pos, state.posMax)\n\n    if (!quoteExtraTagValues || quoteExtraTagValues.label !== 'color') {\n      return false\n    }\n    state.pos = quoteExtraTagValues.valueEndIndex + 1\n\n    if (!cssColorRegex.exec(quoteExtraTagValues.value)) {\n      return false\n    }\n\n    state.pos = quoteExtraTagValues.valueEndIndex + 1\n\n    const token = state.push('quote-extra-color', '', 0)\n    token.attrSet('color', quoteExtraTagValues.value)\n\n    return true\n  })\n\n  md.renderer.rules['quote-extra-color'] = (tokens, idx) => {\n    const token = tokens[idx]\n    const color = token.attrGet('color') ?? ''\n\n    return `<span class=\"quote-extra\" data-color='${color}' style='color: ${color}'><i class=\"fa fa-tag\"></i></span>`\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\nimport { TocAst } from 'markdown-it-toc-done-right'\nimport { documentToc } from './document-toc'\n\nexport const documentTableOfContents = (onTocChange: (toc: TocAst) => void): MarkdownIt.PluginSimple => {\n  return (markdownIt) => documentToc(markdownIt, onTocChange)\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it'\nimport toc, { TocAst } from 'markdown-it-toc-done-right'\nimport { tocSlugify } from '../../editor-page/table-of-contents/toc-slugify'\n\nexport type DocumentTocPluginOptions = (ast: TocAst) => void\n\nexport const documentToc: MarkdownIt.PluginWithOptions<DocumentTocPluginOptions> = (markdownIt, onToc) => {\n  if (!onToc) {\n    return\n  }\n  toc(markdownIt, {\n    placeholder: '(\\\\[TOC\\\\]|\\\\[toc\\\\])',\n    listType: 'ul',\n    level: [1, 2, 3],\n    callback: (code: string, ast: TocAst): void => {\n      onToc(ast)\n    },\n    slugify: tocSlugify\n  })\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it'\nimport abbreviation from 'markdown-it-abbr'\nimport definitionList from 'markdown-it-deflist'\nimport footnote from 'markdown-it-footnote'\nimport imsize from 'markdown-it-imsize'\nimport inserted from 'markdown-it-ins'\nimport marked from 'markdown-it-mark'\nimport subscript from 'markdown-it-sub'\nimport superscript from 'markdown-it-sup'\nimport { alertContainer } from '../markdown-it-plugins/alert-container'\nimport { linkifyExtra } from '../markdown-it-plugins/linkify-extra'\nimport { MarkdownItParserDebugger } from '../markdown-it-plugins/parser-debugger'\nimport { spoilerContainer } from '../markdown-it-plugins/spoiler-container'\nimport { tasksLists } from '../markdown-it-plugins/tasks-lists'\nimport { twitterEmojis } from '../markdown-it-plugins/twitter-emojis'\nimport { RawNoteFrontmatter } from '../../editor-page/note-frontmatter/note-frontmatter'\nimport { TocAst } from 'markdown-it-toc-done-right'\nimport { LineMarkers, lineNumberMarker } from '../replace-components/linemarker/line-number-marker'\nimport { plantumlWithError } from '../markdown-it-plugins/plantuml'\nimport { headlineAnchors } from '../markdown-it-plugins/headline-anchors'\nimport { KatexReplacer } from '../replace-components/katex/katex-replacer'\nimport { YoutubeReplacer } from '../replace-components/youtube/youtube-replacer'\nimport { VimeoReplacer } from '../replace-components/vimeo/vimeo-replacer'\nimport { GistReplacer } from '../replace-components/gist/gist-replacer'\nimport { legacyPdfShortCode } from '../regex-plugins/replace-legacy-pdf-short-code'\nimport { legacySlideshareShortCode } from '../regex-plugins/replace-legacy-slideshare-short-code'\nimport { legacySpeakerdeckShortCode } from '../regex-plugins/replace-legacy-speakerdeck-short-code'\nimport { AsciinemaReplacer } from '../replace-components/asciinema/asciinema-replacer'\nimport { highlightedCode } from '../markdown-it-plugins/highlighted-code'\nimport { quoteExtraColor } from '../markdown-it-plugins/quote-extra-color'\nimport { quoteExtra } from '../markdown-it-plugins/quote-extra'\nimport { documentTableOfContents } from '../markdown-it-plugins/document-table-of-contents'\nimport { frontmatterExtract } from '../markdown-it-plugins/frontmatter'\n\nexport interface ConfiguratorDetails {\n  useFrontmatter: boolean\n  onParseError: (error: boolean) => void\n  onRawMetaChange: (rawMeta: RawNoteFrontmatter) => void\n  onToc: (toc: TocAst) => void\n  onLineMarkers?: (lineMarkers: LineMarkers[]) => void\n  useAlternativeBreaks?: boolean\n}\n\nexport class BasicMarkdownItConfigurator<T extends ConfiguratorDetails> {\n  protected readonly options: T\n  protected configurations: MarkdownIt.PluginSimple[] = []\n  protected postConfigurations: MarkdownIt.PluginSimple[] = []\n\n  constructor(options: T) {\n    this.options = options\n  }\n\n  public pushConfig(plugin: MarkdownIt.PluginSimple): this {\n    this.configurations.push(plugin)\n    return this\n  }\n\n  public buildConfiguredMarkdownIt(): MarkdownIt {\n    const markdownIt = new MarkdownIt('default', {\n      html: true,\n      breaks: this.options.useAlternativeBreaks ?? true,\n      langPrefix: '',\n      typographer: true\n    })\n    this.configure(markdownIt)\n    this.configurations.forEach((configuration) => markdownIt.use(configuration))\n    this.postConfigurations.forEach((postConfiguration) => markdownIt.use(postConfiguration))\n    return markdownIt\n  }\n\n  protected configure(markdownIt: MarkdownIt): void {\n    this.configurations.push(\n      plantumlWithError,\n      headlineAnchors,\n      KatexReplacer.markdownItPlugin,\n      YoutubeReplacer.markdownItPlugin,\n      VimeoReplacer.markdownItPlugin,\n      GistReplacer.markdownItPlugin,\n      legacyPdfShortCode,\n      legacySlideshareShortCode,\n      legacySpeakerdeckShortCode,\n      AsciinemaReplacer.markdownItPlugin,\n      highlightedCode,\n      quoteExtraColor,\n      quoteExtra('name', 'user'),\n      quoteExtra('time', 'clock-o'),\n      documentTableOfContents(this.options.onToc),\n      twitterEmojis,\n      abbreviation,\n      definitionList,\n      subscript,\n      superscript,\n      inserted,\n      marked,\n      footnote,\n      imsize,\n      tasksLists,\n      alertContainer,\n      spoilerContainer\n    )\n\n    if (this.options.useFrontmatter) {\n      this.configurations.push(\n        frontmatterExtract({\n          onParseError: this.options.onParseError,\n          onRawMetaChange: this.options.onRawMetaChange\n        })\n      )\n    }\n\n    if (this.options.onLineMarkers) {\n      this.configurations.push(lineNumberMarker(this.options.onLineMarkers))\n    }\n\n    this.postConfigurations.push(linkifyExtra, MarkdownItParserDebugger)\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport yaml from 'js-yaml'\nimport MarkdownIt from 'markdown-it'\nimport frontmatter from 'markdown-it-front-matter'\nimport { RawNoteFrontmatter } from '../../editor-page/note-frontmatter/note-frontmatter'\n\ninterface FrontmatterPluginOptions {\n  onParseError: (error: boolean) => void\n  onRawMetaChange: (rawMeta: RawNoteFrontmatter) => void\n}\n\nexport const frontmatterExtract: (options: FrontmatterPluginOptions) => MarkdownIt.PluginSimple =\n  (options) => (markdownIt) => {\n    frontmatter(markdownIt, (rawMeta: string) => {\n      try {\n        const meta: RawNoteFrontmatter = yaml.load(rawMeta) as RawNoteFrontmatter\n        options.onParseError(false)\n        options.onRawMetaChange(meta)\n      } catch (e) {\n        console.error(e)\n        options.onParseError(true)\n        options.onRawMetaChange({} as RawNoteFrontmatter)\n      }\n    })\n  }\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport MarkdownIt from 'markdown-it/lib'\nimport Token from 'markdown-it/lib/token'\n\nexport interface LineMarkers {\n  startLine: number\n  endLine: number\n}\n\nexport type LineNumberMarkerOptions = (lineMarkers: LineMarkers[]) => void\n\n/**\n * This plugin adds markers to the dom, that are used to map line numbers to dom elements.\n * It also provides a list of line numbers for the top level dom elements.\n */\nexport const lineNumberMarker: (options: LineNumberMarkerOptions) => MarkdownIt.PluginSimple =\n  (options) => (md: MarkdownIt) => {\n    // add app_linemarker token before each opening or self-closing level-0 tag\n    md.core.ruler.push('line_number_marker', (state) => {\n      const lineMarkers: LineMarkers[] = []\n      tagTokens(state.tokens, lineMarkers)\n      if (options) {\n        options(lineMarkers)\n      }\n      return true\n    })\n\n    md.renderer.rules.app_linemarker = (tokens: Token[], index: number): string => {\n      const startLineNumber = tokens[index].attrGet('data-start-line')\n      const endLineNumber = tokens[index].attrGet('data-end-line')\n\n      if (!startLineNumber || !endLineNumber) {\n        // don't render broken linemarkers without a linenumber\n        return ''\n      }\n      // noinspection CheckTagEmptyBody\n      return `<app-linemarker data-start-line='${startLineNumber}' data-end-line='${endLineNumber}'></app-linemarker>`\n    }\n\n    const insertNewLineMarker = (\n      startLineNumber: number,\n      endLineNumber: number,\n      tokenPosition: number,\n      level: number,\n      tokens: Token[]\n    ) => {\n      const startToken = new Token('app_linemarker', 'app-linemarker', 0)\n      startToken.level = level\n      startToken.attrPush(['data-start-line', `${startLineNumber}`])\n      startToken.attrPush(['data-end-line', `${endLineNumber}`])\n      tokens.splice(tokenPosition, 0, startToken)\n    }\n\n    const tagTokens = (tokens: Token[], lineMarkers: LineMarkers[]) => {\n      for (let tokenPosition = 0; tokenPosition < tokens.length; tokenPosition++) {\n        const token = tokens[tokenPosition]\n        if (token.hidden) {\n          continue\n        }\n\n        if (!token.map) {\n          continue\n        }\n\n        const startLineNumber = token.map[0] + 1\n        const endLineNumber = token.map[1] + 1\n\n        if (token.level === 0) {\n          lineMarkers.push({ startLine: startLineNumber, endLine: endLineNumber })\n        }\n\n        insertNewLineMarker(startLineNumber, endLineNumber, tokenPosition, token.level, tokens)\n        tokenPosition += 1\n\n        if (token.children) {\n          tagTokens(token.children, lineMarkers)\n        }\n      }\n    }\n  }\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React from 'react'\nimport { Alert } from 'react-bootstrap'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { InternalLink } from '../common/links/internal-link'\nimport { ShowIf } from '../common/show-if/show-if'\nimport { SimpleAlertProps } from '../common/simple-alert/simple-alert-props'\n\nexport const InvalidYamlAlert: React.FC<SimpleAlertProps> = ({ show }) => {\n  useTranslation()\n\n  return (\n    <ShowIf condition={show}>\n      <Alert variant='warning' dir='auto'>\n        <Trans i18nKey='editor.invalidYaml'>\n          <InternalLink text='yaml-metadata' href='/n/yaml-metadata' className='text-primary' />\n        </Trans>\n      </Alert>\n    </ShowIf>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { Ref, useCallback, useMemo, useRef, useState } from 'react'\nimport { DocumentLengthLimitReachedAlert } from './document-length-limit-reached-alert'\nimport { useConvertMarkdownToReactDom } from './hooks/use-convert-markdown-to-react-dom'\nimport './markdown-renderer.scss'\nimport { ComponentReplacer } from './replace-components/ComponentReplacer'\nimport { AdditionalMarkdownRendererProps, LineMarkerPosition } from './types'\nimport { useComponentReplacers } from './hooks/use-component-replacers'\nimport { useTranslation } from 'react-i18next'\nimport { NoteFrontmatter, RawNoteFrontmatter } from '../editor-page/note-frontmatter/note-frontmatter'\nimport { LineMarkers } from './replace-components/linemarker/line-number-marker'\nimport { useCalculateLineMarkerPosition } from './utils/calculate-line-marker-positions'\nimport { useExtractFirstHeadline } from './hooks/use-extract-first-headline'\nimport { TocAst } from 'markdown-it-toc-done-right'\nimport { useOnRefChange } from './hooks/use-on-ref-change'\nimport { BasicMarkdownItConfigurator } from './markdown-it-configurator/BasicMarkdownItConfigurator'\nimport { ImageClickHandler } from './replace-components/image/image-replacer'\nimport { InvalidYamlAlert } from './invalid-yaml-alert'\nimport { useTrimmedContent } from './hooks/use-trimmed-content'\n\nexport interface BasicMarkdownRendererProps {\n  additionalReplacers?: () => ComponentReplacer[]\n  onBeforeRendering?: () => void\n  onAfterRendering?: () => void\n  onFirstHeadingChange?: (firstHeading: string | undefined) => void\n  onLineMarkerPositionChanged?: (lineMarkerPosition: LineMarkerPosition[]) => void\n  onFrontmatterChange?: (frontmatter: NoteFrontmatter | undefined) => void\n  onTaskCheckedChange?: (lineInMarkdown: number, checked: boolean) => void\n  onTocChange?: (ast?: TocAst) => void\n  baseUrl?: string\n  onImageClick?: ImageClickHandler\n  outerContainerRef?: Ref<HTMLDivElement>\n  useAlternativeBreaks?: boolean\n}\n\nexport const BasicMarkdownRenderer: React.FC<BasicMarkdownRendererProps & AdditionalMarkdownRendererProps> = ({\n  className,\n  content,\n  additionalReplacers,\n  onBeforeRendering,\n  onAfterRendering,\n  onFirstHeadingChange,\n  onLineMarkerPositionChanged,\n  onFrontmatterChange,\n  onTaskCheckedChange,\n  onTocChange,\n  baseUrl,\n  onImageClick,\n  outerContainerRef,\n  useAlternativeBreaks\n}) => {\n  const rawMetaRef = useRef<RawNoteFrontmatter>()\n  const markdownBodyRef = useRef<HTMLDivElement>(null)\n  const currentLineMarkers = useRef<LineMarkers[]>()\n  const hasNewYamlError = useRef(false)\n  const tocAst = useRef<TocAst>()\n  const [showYamlError, setShowYamlError] = useState(false)\n  const [trimmedContent, contentExceedsLimit] = useTrimmedContent(content)\n\n  const markdownIt = useMemo(\n    () =>\n      new BasicMarkdownItConfigurator({\n        useFrontmatter: !!onFrontmatterChange,\n        onParseError: (errorState) => (hasNewYamlError.current = errorState),\n        onRawMetaChange: (rawMeta) => (rawMetaRef.current = rawMeta),\n        onToc: (toc) => (tocAst.current = toc),\n        onLineMarkers:\n          onLineMarkerPositionChanged === undefined\n            ? undefined\n            : (lineMarkers) => (currentLineMarkers.current = lineMarkers),\n        useAlternativeBreaks\n      }).buildConfiguredMarkdownIt(),\n    [onFrontmatterChange, onLineMarkerPositionChanged, useAlternativeBreaks]\n  )\n\n  const clearFrontmatter = useCallback(() => {\n    hasNewYamlError.current = false\n    rawMetaRef.current = undefined\n    onBeforeRendering?.()\n  }, [onBeforeRendering])\n\n  const checkYamlErrorState = useCallback(() => {\n    setShowYamlError(hasNewYamlError.current)\n    onAfterRendering?.()\n  }, [onAfterRendering])\n\n  const baseReplacers = useComponentReplacers(onTaskCheckedChange, onImageClick, baseUrl)\n  const replacers = useCallback(\n    () => baseReplacers().concat(additionalReplacers ? additionalReplacers() : []),\n    [additionalReplacers, baseReplacers]\n  )\n\n  const markdownReactDom = useConvertMarkdownToReactDom(\n    trimmedContent,\n    markdownIt,\n    replacers,\n    clearFrontmatter,\n    checkYamlErrorState\n  )\n\n  useTranslation()\n  useCalculateLineMarkerPosition(\n    markdownBodyRef,\n    currentLineMarkers.current,\n    onLineMarkerPositionChanged,\n    markdownBodyRef.current?.offsetTop ?? 0\n  )\n  useExtractFirstHeadline(markdownBodyRef, content, onFirstHeadingChange)\n  useOnRefChange(tocAst, onTocChange)\n  useOnRefChange(rawMetaRef, (newValue) => {\n    if (!newValue) {\n      onFrontmatterChange?.(undefined)\n    } else {\n      onFrontmatterChange?.(new NoteFrontmatter(newValue))\n    }\n  })\n\n  return (\n    <div ref={outerContainerRef} className={'position-relative'}>\n      <InvalidYamlAlert show={showYamlError} />\n      <DocumentLengthLimitReachedAlert show={contentExceedsLimit} />\n      <div\n        ref={markdownBodyRef}\n        className={`${className ?? ''} markdown-body w-100 d-flex flex-column align-items-center`}>\n        {markdownReactDom}\n      </div>\n    </div>\n  )\n}\n\nexport default BasicMarkdownRenderer\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { useMemo } from 'react'\nimport { useApplicationState } from '../../../hooks/common/use-application-state'\n\nexport const useTrimmedContent = (content: string): [trimmedContent: string, contentExceedsLimit: boolean] => {\n  const maxLength = useApplicationState((state) => state.config.maxDocumentLength)\n  const contentExceedsLimit = content.length > maxLength\n\n  const trimmedContent = useMemo(\n    () => (contentExceedsLimit ? content.substr(0, maxLength) : content),\n    [content, contentExceedsLimit, maxLength]\n  )\n  return [trimmedContent, contentExceedsLimit]\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { useCallback, useEffect, useRef } from 'react'\n\nexport const useExtractFirstHeadline = (\n  documentElement: React.RefObject<HTMLDivElement>,\n  content: string,\n  onFirstHeadingChange?: (firstHeading: string | undefined) => void\n): void => {\n  const extractInnerText = useCallback((node: ChildNode | null): string => {\n    if (!node) {\n      return ''\n    }\n\n    if ((node as HTMLElement).classList?.contains('katex-mathml')) {\n      return ''\n    }\n\n    let innerText = ''\n\n    if (node.childNodes && node.childNodes.length > 0) {\n      node.childNodes.forEach((child) => {\n        innerText += extractInnerText(child)\n      })\n    } else if (node.nodeName === 'IMG') {\n      innerText += (node as HTMLImageElement).getAttribute('alt')\n    } else {\n      innerText += node.textContent\n    }\n    return innerText\n  }, [])\n\n  const lastFirstHeading = useRef<string | undefined>()\n\n  useEffect(() => {\n    if (onFirstHeadingChange && documentElement.current) {\n      const firstHeading = documentElement.current.getElementsByTagName('h1').item(0)\n      const headingText = extractInnerText(firstHeading).trim()\n      if (headingText !== lastFirstHeading.current) {\n        lastFirstHeading.current = headingText\n        onFirstHeadingChange(headingText)\n      }\n    }\n  }, [documentElement, extractInnerText, onFirstHeadingChange, content])\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport { Element, isText, NodeWithChildren } from 'domhandler'\nimport MarkdownIt from 'markdown-it'\nimport { ReactElement } from 'react'\n\nexport type ValidReactDomElement = ReactElement | string | null\n\nexport type SubNodeTransform = (node: Element, subKey: number | string) => ValidReactDomElement | void\n\nexport type NativeRenderer = () => ValidReactDomElement\n\nexport type MarkdownItPlugin = MarkdownIt.PluginSimple | MarkdownIt.PluginWithOptions | MarkdownIt.PluginWithParams\n\n/**\n * Base class for all component replacers.\n * Component replacers detect structures in the HTML DOM from markdown it\n * and replace them with some special react components.\n */\nexport abstract class ComponentReplacer {\n  /**\n   * Extracts the content of the first text child node.\n   *\n   * @param node the node with the text node child\n   * @return the string content\n   */\n  protected static extractTextChildContent(node: NodeWithChildren): string {\n    const childrenTextNode = node.children[0]\n    return isText(childrenTextNode) ? childrenTextNode.data : ''\n  }\n\n  /**\n   * Checks if the current node should be altered or replaced and does if needed.\n   *\n   * @param node The current html dom node\n   * @param subNodeTransform should be used to convert child elements of the current node\n   * @param nativeRenderer renders the current node as it is without any replacement.\n   * @return the replacement for the current node or undefined if the current replacer replacer hasn't done anything.\n   */\n  public abstract getReplacement(\n    node: Element,\n    subNodeTransform: SubNodeTransform,\n    nativeRenderer: NativeRenderer\n  ): ValidReactDomElement | undefined\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\nimport { Element } from 'domhandler'\nimport React from 'react'\nimport { ComponentReplacer, NativeRenderer, SubNodeTransform, ValidReactDomElement } from '../ComponentReplacer'\n\nexport const createJumpToMarkClickEventHandler = (id: string) => {\n  return (event: React.MouseEvent<HTMLElement, MouseEvent>): void => {\n    document.getElementById(id)?.scrollIntoView()\n    event.preventDefault()\n  }\n}\n\n/**\n * Detects link tags and polishs them.\n * This replacer prevents data and javascript links,\n * extends relative links with the base url and creates working jump links.\n */\nexport class LinkReplacer extends ComponentReplacer {\n  constructor(private baseUrl?: string) {\n    super()\n  }\n\n  public getReplacement(\n    node: Element,\n    subNodeTransform: SubNodeTransform,\n    nativeRenderer: NativeRenderer\n  ): ValidReactDomElement | undefined {\n    if (node.name !== 'a' || !node.attribs || !node.attribs.href) {\n      return undefined\n    }\n\n    const url = node.attribs.href.trim()\n\n    // eslint-disable-next-line no-script-url\n    if (url.startsWith('data:') || url.startsWith('javascript:')) {\n      return <span>{node.attribs.href}</span>\n    }\n\n    const isJumpMark = url.substr(0, 1) === '#'\n\n    const id = url.substr(1)\n\n    try {\n      node.attribs.href = new URL(url, this.baseUrl).toString()\n    } catch (e) {\n      node.attribs.href = url\n    }\n\n    if (isJumpMark) {\n      return <span onClick={createJumpToMarkClickEventHandler(id)}>{nativeRenderer()}</span>\n    } else {\n      node.attribs.rel = 'noreferer noopener'\n      node.attribs.target = '_blank'\n      return nativeRenderer()\n    }\n  }\n}\n","var map = {\n\t\"./bmp\": 628,\n\t\"./bmp.js\": 628,\n\t\"./gif\": 629,\n\t\"./gif.js\": 629,\n\t\"./jpg\": 630,\n\t\"./jpg.js\": 630,\n\t\"./png\": 631,\n\t\"./png.js\": 631,\n\t\"./psd\": 632,\n\t\"./psd.js\": 632,\n\t\"./svg\": 633,\n\t\"./svg.js\": 633,\n\t\"./tiff\": 634,\n\t\"./tiff.js\": 634,\n\t\"./webp\": 635,\n\t\"./webp.js\": 635\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 627;","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nexport const tocSlugify = (content: string): string => {\n  return encodeURIComponent(content.trim().toLowerCase().replace(/\\s+/g, '-'))\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { Fragment, useRef } from 'react'\nimport { Button } from 'react-bootstrap'\nimport { Variant } from 'react-bootstrap/types'\nimport { useTranslation } from 'react-i18next'\nimport { ForkAwesomeIcon } from '../../fork-awesome/fork-awesome-icon'\nimport { CopyOverlay } from '../copy-overlay'\n\nexport interface CopyToClipboardButtonProps {\n  content: string\n  size?: 'sm' | 'lg'\n  variant?: Variant\n  'data-cy'?: string\n}\n\nexport const CopyToClipboardButton: React.FC<CopyToClipboardButtonProps> = ({\n  content,\n  size = 'sm',\n  variant = 'dark',\n  ...props\n}) => {\n  const { t } = useTranslation()\n  const button = useRef<HTMLButtonElement>(null)\n\n  return (\n    <Fragment>\n      <Button\n        ref={button}\n        size={size}\n        variant={variant}\n        title={t('renderer.highlightCode.copyCode')}\n        data-cy={props['data-cy']}>\n        <ForkAwesomeIcon icon='files-o' />\n      </Button>\n      <CopyOverlay content={content} clickComponent={button} />\n    </Fragment>\n  )\n}\n","/*\n * SPDX-FileCopyrightText: 2021 The HedgeDoc developers (see AUTHORS file)\n *\n * SPDX-License-Identifier: AGPL-3.0-only\n */\n\nimport React, { Fragment, ReactElement, useEffect, useState } from 'react'\nimport convertHtmlToReact from '@hedgedoc/html-to-react'\nimport { CopyToClipboardButton } from '../../../../common/copyable/copy-to-clipboard-button/copy-to-clipboard-button'\nimport '../../../utils/button-inside.scss'\nimport './highlighted-code.scss'\n\nexport interface HighlightedCodeProps {\n  code: string\n  language?: string\n  startLineNumber?: number\n  wrapLines: boolean\n}\n\n/*\n TODO: Test method or rewrite code so this is not necessary anymore\n */\nconst escapeHtml = (unsafe: string): string => {\n  return unsafe\n    .replaceAll(/&/g, '&amp;')\n    .replaceAll(/</g, '&lt;')\n    .replaceAll(/>/g, '&gt;')\n    .replaceAll(/\"/g, '&quot;')\n    .replaceAll(/'/g, '&#039;')\n}\n\nconst replaceCode = (code: string): (ReactElement | null | string)[][] => {\n  return code\n    .split('\\n')\n    .filter((line) => !!line)\n    .map((line) => convertHtmlToReact(line, {}))\n}\n\nexport const HighlightedCode: React.FC<HighlightedCodeProps> = ({ code, language, startLineNumber, wrapLines }) => {\n  const [dom, setDom] = useState<ReactElement[]>()\n\n  useEffect(() => {\n    import(/* webpackChunkName: \"highlight.js\" */ '../../../../common/hljs/hljs')\n      .then((hljs) => {\n        const languageSupported = (lang: string) => hljs.default.listLanguages().includes(lang)\n        const unreplacedCode =\n          !!language && languageSupported(language)\n            ? hljs.default.highlight(code, { language }).value\n            : escapeHtml(code)\n        const replacedDom = replaceCode(unreplacedCode).map((line, index) => (\n          <Fragment key={index}>\n            <span className={'linenumber'}>{(startLineNumber || 1) + index}</span>\n            <div className={'codeline'}>{line}</div>\n          </Fragment>\n        ))\n        setDom(replacedDom)\n      })\n      .catch(() => {\n        console.error('error while loading highlight.js')\n      })\n  }, [code, language, startLineNumber])\n\n  return (\n    <Fragment>\n      <code className={`hljs ${startLineNumber !== undefined ? 'showGutter' : ''} ${wrapLines ? 'wrapLines' : ''}`}>\n        {dom}\n      </code>\n      <div className={'text-right button-inside'}>\n        <CopyToClipboardButton content={code} data-cy='copy-code-button' />\n      </div>\n    </Fragment>\n  )\n}\n\nexport default HighlightedCode\n"],"sourceRoot":""}